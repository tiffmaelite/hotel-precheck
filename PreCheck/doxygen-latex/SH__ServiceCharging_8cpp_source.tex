\hypertarget{SH__ServiceCharging_8cpp}{\section{S\-H\-\_\-\-Service\-Charging.\-cpp}
\label{SH__ServiceCharging_8cpp}\index{/home/tiff/\-Stage-\/\-I\-U\-T/app/simplhotel/hotel-\/precheck/src/\-Pre\-Check/logic/\-S\-H\-\_\-\-Service\-Charging.\-cpp@{/home/tiff/\-Stage-\/\-I\-U\-T/app/simplhotel/hotel-\/precheck/src/\-Pre\-Check/logic/\-S\-H\-\_\-\-Service\-Charging.\-cpp}}
}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "\hyperlink{SH__ServiceCharging_8h}{SH\_ServiceCharging.h}"}
00002 \textcolor{preprocessor}{#include "\hyperlink{SH__ValidationState_8h}{SH\_ValidationState.h}"}
00003 \textcolor{preprocessor}{#include "\hyperlink{SH__DatabaseContentQuestionState_8h}{SH\_DatabaseContentQuestionState.h}"}
00004 \textcolor{preprocessor}{#include "\hyperlink{SH__StringQuestionState_8h}{SH\_StringQuestionState.h}"}
00005 \textcolor{preprocessor}{#include "\hyperlink{SH__DecimalQuestionState_8h}{SH\_DecimalQuestionState.h}"}
00006 \textcolor{preprocessor}{#include "\hyperlink{SH__DatabaseManager_8h}{SH\_DatabaseManager.h}"}
00007 \textcolor{preprocessor}{#include <QtSql>}
00008 
\hypertarget{SH__ServiceCharging_8cpp_source_l00012}{}\hyperlink{classSH__ServiceCharging_afa5273d046049b1c2b020a6a19a8290b}{00012} \hyperlink{classSH__ServiceCharging_afa5273d046049b1c2b020a6a19a8290b}{SH\_ServiceCharging::SH\_ServiceCharging}(QString name, 
      \hyperlink{classQObject}{QObject} *parent) :
00013     \hyperlink{classSH__LoopingInOutStateMachine}{SH\_LoopingInOutStateMachine}(\textcolor{stringliteral}{"CHARGEDSERVICES"},name, 0, parent), m\_priceMin(0
      .0)
00014 \{
00015     \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}* service = \textcolor{keyword}{new} 
      \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}(\textcolor{stringliteral}{"Veuillez sélectionner une prestation ou
       appuyer sur la touche \(\backslash\)"VALIDER\(\backslash\)" pour cesser d'ajouter des prestations"}, \textcolor{stringliteral}{"choose service in service charging"},\textcolor{stringliteral}{
      "SERVICES"},\textcolor{stringliteral}{"CODE"});
00016     \hyperlink{classSH__InOutState}{SH\_InOutState}*serviceId = \textcolor{keyword}{new} \hyperlink{classSH__InOutState}{SH\_InOutState}(\textcolor{stringliteral}{""},\textcolor{stringliteral}{"service id in service
       charging"});
00017     serviceId->\hyperlink{classSH__InOutState_a7fdfaa6f600f0ac4a96f238a038ba9ad}{setVisibility}(\textcolor{keyword}{false});
00018     \hyperlink{classSH__StringQuestionState}{SH\_StringQuestionState}* serviceName = \textcolor{keyword}{new} 
      \hyperlink{classSH__StringQuestionState}{SH\_StringQuestionState}(\textcolor{stringliteral}{"Veuillez entrer ce qui sera affiché sur la facture"}, \textcolor{stringliteral}{"service
       name in service charging"},1);
00019     \hyperlink{classSH__DecimalQuestionState}{SH\_DecimalQuestionState}* price = \textcolor{keyword}{new} 
      \hyperlink{classSH__DecimalQuestionState}{SH\_DecimalQuestionState}(\textcolor{stringliteral}{""}, \textcolor{stringliteral}{"price in service charging"},-Q\_INFINITY,Q\_INFINITY);
00020     \hyperlink{classSH__DecimalQuestionState}{SH\_DecimalQuestionState}* quantity = \textcolor{keyword}{new} 
      \hyperlink{classSH__DecimalQuestionState}{SH\_DecimalQuestionState}(\textcolor{stringliteral}{""}, \textcolor{stringliteral}{"quantity in service charging"},1);
00021     \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}* vat = \textcolor{keyword}{new} 
      \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}(\textcolor{stringliteral}{""}, \textcolor{stringliteral}{"vat in service charging"},\textcolor{stringliteral}{"TAXES"},\textcolor{stringliteral}{"
      PERCENTAGE"},\textcolor{stringliteral}{"ENABLED='1'"});
00022     QFinalState* \textcolor{keyword}{final} = \textcolor{keyword}{new} QFinalState();
00023 
00024 
00025     connect(service, &\hyperlink{classSH__QuestionState_a3348a8a683130678ac87a10ba2a25486}{SH\_QuestionState::answerInvalid}, [=]() \{
00026         \textcolor{keywordtype}{int} in = service->\hyperlink{classSH__DatabaseContentQuestionState_aed9d5e4205ca37d32653475ac13fe097}{rawInput}().toInt();
00027         \textcolor{keywordflow}{if}(in == -1 || in == 0) \{
00028             emit service->\hyperlink{classSH__GenericState_a34c1bebc765cc3a62d66c94c37d4f0c3}{goNext}();
00029         \}
00030     \});
00031     connect(service, &\hyperlink{classSH__QuestionState_a04e259643788d15ab6244bc8a04286d6}{SH\_QuestionState::answerValid}, [=]() \{
00032         \textcolor{keywordflow}{if}(service->\hyperlink{classSH__DatabaseContentQuestionState_aed9d5e4205ca37d32653475ac13fe097}{rawInput}().toInt() > -1) \{
00033             QString \hyperlink{classSH__NamedObject_a9f686c6f2a5bcc08ad03d0cee0151f0f}{name};
00034             QStringList list;
00035             list.append(\textcolor{stringliteral}{"PRINTEDNAME"});
00036             list.append(\textcolor{stringliteral}{"PRICEMIN"});
00037             list.append(\textcolor{stringliteral}{"PRICEMAX"});
00038             list.append(\textcolor{stringliteral}{"VAT\_PERCENTAGE"});
00039             list.append(\textcolor{stringliteral}{"ID"});
00040             QSqlQuery result = \hyperlink{classSH__DatabaseManager_a31198eb4de0f8b18e3fa0eed09f24d19}{SH\_DatabaseManager::getInstance}()->
      \hyperlink{classSH__DatabaseManager_ab8f9850cb68444ab9a4e613b36a3b044}{execSelectQuery}(\textcolor{stringliteral}{"SERVICESINFOS"}, list, QString(\textcolor{stringliteral}{"CODE=%1"}).arg(service->
      \hyperlink{classSH__DatabaseContentQuestionState_aed9d5e4205ca37d32653475ac13fe097}{rawInput}().toString()));
00041             result.next();
00042             QSqlRecord record = result.record();
00043             name= record.value(0).toString();
00044             \hyperlink{classSH__ServiceCharging_a44584a7ff1edd6ae03c4f77544136c13}{m\_priceMin} =record.value(1).toDouble();
00045             \hyperlink{classSH__ServiceCharging_ae2fa75c56883dc4af6b0bbcbb86d0861}{m\_vat} =record.value(3).toDouble();
00046             serviceId->\hyperlink{classSH__InOutState_aaec9c2b5ef7c406bff7469461352d47c}{setInput}(record.value(4).toInt());
00047             serviceName->\hyperlink{classSH__QuestionState_ab40b6202090d1afcc965e124b2deb88a}{setInput}(name);
00048             price->\hyperlink{classSH__InOutState_af611c84134e262739cd834797b315c80}{setOutput}(QString(\textcolor{stringliteral}{"Le prix proposé pour cette prestation est : %1. Son prix
       minimum est %1 et son prix maximum %2.\(\backslash\)nVeuillez entrer un nouveau prix ou appuyer sur la touche \(\backslash\)"CONFIRMER\(\backslash\)""}
      ).arg(record.value(1).toString()).arg(record.value(2).toString()));
00049             vat->\hyperlink{classSH__DatabaseContentQuestionState_aaec6c7f8bc78c6beb7447fc41ffe3875}{setOutput}(QString(\textcolor{stringliteral}{"Cette prestation est associée à une TVA de %1\(\backslash\)%.\(\backslash\)nVeuillez
       entrer une autre TVA à appliquer ou appuyer sur la touche \(\backslash\)"CONFIRMER\(\backslash\)""}).arg(record.value(3).toString()));
00050             serviceName->\hyperlink{classSH__InOutState_a7fdfaa6f600f0ac4a96f238a038ba9ad}{setVisibility}(\textcolor{keyword}{false});
00051         \}
00052     \});
00053     connect(quantity, &QState::entered, [=]() \{
00054         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_a037ed5e13ecfae2123a8d4940292e410}{SH\_InOutStateMachine::receiveInput}, [=](QString in
      ) \{
00055             QString newInput;
00056             \textcolor{keywordflow}{if}(in.right(in.length() - 1).toInt() != 0) \{
00057                 newInput = in.right(in.length() - 1);
00058             \}
00059             emit \hyperlink{classSH__InOutStateMachine_a037ed5e13ecfae2123a8d4940292e410}{receiveInput}(newInput);
00060         \});
00061     \});
00062     connect(price, &QState::entered, [=]() \{
00063         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_a7f7d9c9300c1d05bce2c26029f28cc31}{SH\_InOutStateMachine::confirmInput}, [=]() \{
00064             price->\hyperlink{classSH__QuestionState_ab40b6202090d1afcc965e124b2deb88a}{setInput}(\hyperlink{classSH__ServiceCharging_a44584a7ff1edd6ae03c4f77544136c13}{m\_priceMin});
00065         \});
00066     \});
00067     connect(vat, &QState::entered, [=]() \{
00068         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_a7f7d9c9300c1d05bce2c26029f28cc31}{SH\_InOutStateMachine::confirmInput}, [=]() \{
00069             vat->\hyperlink{classSH__QuestionState_ab40b6202090d1afcc965e124b2deb88a}{setInput}(\hyperlink{classSH__ServiceCharging_ae2fa75c56883dc4af6b0bbcbb86d0861}{m\_vat});
00070         \});
00071     \});
00072 
00073 
00074     this->addState(\textcolor{keyword}{final});
00075     this->\hyperlink{classSH__InOutStateMachine_a2528cffddbe6f98c32ebef41423c0118}{addIOState}(service, \textcolor{stringliteral}{""});
00076     this->\hyperlink{classSH__InOutStateMachine_a2528cffddbe6f98c32ebef41423c0118}{addIOState}(serviceId, \textcolor{stringliteral}{"SERVICE\_ID"});
00077     this->\hyperlink{classSH__InOutStateMachine_a2528cffddbe6f98c32ebef41423c0118}{addIOState}(serviceName, \textcolor{stringliteral}{"PRINTEDNAME"});
00078     this->\hyperlink{classSH__InOutStateMachine_a2528cffddbe6f98c32ebef41423c0118}{addIOState}(price, \textcolor{stringliteral}{"CHARGEDUNITPRICE"});
00079     this->\hyperlink{classSH__InOutStateMachine_a2528cffddbe6f98c32ebef41423c0118}{addIOState}(quantity, \textcolor{stringliteral}{"QUANTITY"});
00080     this->\hyperlink{classSH__InOutStateMachine_a2528cffddbe6f98c32ebef41423c0118}{addIOState}(vat, \textcolor{stringliteral}{"CHARGEDVAT"});
00081     this->\hyperlink{classSH__LoopingInOutStateMachine_abfae9f47019379f270496de46845c729}{addChildrenNextTransition}(service, serviceId);
00082     this->\hyperlink{classSH__LoopingInOutStateMachine_abfae9f47019379f270496de46845c729}{addChildrenNextTransition}(serviceId, serviceName);
00083     this->\hyperlink{classSH__LoopingInOutStateMachine_abfae9f47019379f270496de46845c729}{addChildrenNextTransition}(serviceName, quantity);
00084     this->\hyperlink{classSH__LoopingInOutStateMachine_abfae9f47019379f270496de46845c729}{addChildrenNextTransition}(quantity, price);
00085     this->\hyperlink{classSH__LoopingInOutStateMachine_abfae9f47019379f270496de46845c729}{addChildrenNextTransition}(price, vat);
00086     this->\hyperlink{classSH__LoopingInOutStateMachine_abfae9f47019379f270496de46845c729}{addChildrenNextTransition}(vat, \textcolor{keyword}{final});
00087     this->setInitialState(service);
00088     connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_aec1b3fef3c1f82499aa1f73beaecd08a}{SH\_InOutStateMachine::validateInput}, \textcolor{keyword}{this}, &
      \hyperlink{classSH__LoopingInOutStateMachine_a73d75e30318da22fec99387e9bf02a9b}{SH\_LoopingInOutStateMachine::stopLooping});
00089 \}
\end{DoxyCode}
