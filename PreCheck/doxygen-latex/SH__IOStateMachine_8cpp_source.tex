\hypertarget{SH__IOStateMachine_8cpp}{\section{S\-H\-\_\-\-I\-O\-State\-Machine.\-cpp}
\label{SH__IOStateMachine_8cpp}\index{/home/tiff/\-Stage-\/\-I\-U\-T/app/simplhotel/hotel-\/precheck/src/\-Pre\-Check/logic/\-S\-H\-\_\-\-I\-O\-State\-Machine.\-cpp@{/home/tiff/\-Stage-\/\-I\-U\-T/app/simplhotel/hotel-\/precheck/src/\-Pre\-Check/logic/\-S\-H\-\_\-\-I\-O\-State\-Machine.\-cpp}}
}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "\hyperlink{SH__IOStateMachine_8h}{SH\_IOStateMachine.h}"}
00002 \textcolor{preprocessor}{#include "\hyperlink{SH__ValidationState_8h}{SH\_ValidationState.h}"}
00003 \textcolor{preprocessor}{#include "\hyperlink{SH__ConfirmationState_8h}{SH\_ConfirmationState.h}"}
00004 \textcolor{preprocessor}{#include "\hyperlink{SH__FileSelectionState_8h}{SH\_FileSelectionState.h}"}
00005 \textcolor{preprocessor}{#include "\hyperlink{SH__DateQuestionState_8h}{SH\_DateQuestionState.h}"}
00006 \textcolor{preprocessor}{#include "\hyperlink{SH__AdaptDatabaseState_8h}{SH\_AdaptDatabaseState.h}"}
00007 \textcolor{preprocessor}{#include "\hyperlink{SH__DatabaseContentQuestionState_8h}{SH\_DatabaseContentQuestionState.h}"}
00008 \textcolor{preprocessor}{#include "\hyperlink{SH__MessageManager_8h}{SH\_MessageManager.h}"}
00009 \textcolor{comment}{/*namespace SimplHotel}
00010 \textcolor{comment}{\{*/}
\hypertarget{SH__IOStateMachine_8cpp_source_l00015}{}\hyperlink{classSH__InOutStateMachine_abd780037922920c674b43d80c2b50d16}{00015} \hyperlink{classSH__InOutStateMachine_abd780037922920c674b43d80c2b50d16}{SH\_InOutStateMachine::SH\_InOutStateMachine}(QString tableName, 
      QString name, \hyperlink{classQObject}{QObject} *parent) :
00016     \hyperlink{classSH__GenericStateMachine}{SH\_GenericStateMachine}(name, parent), m\_tableName(tableName)
00017 \{
00018 \}
\hypertarget{SH__IOStateMachine_8cpp_source_l00023}{}\hyperlink{classSH__InOutStateMachine_aaca105fbd5f5cc3bac115389ad3694c5}{00023} QVariantMap \hyperlink{classSH__InOutStateMachine_aaca105fbd5f5cc3bac115389ad3694c5}{SH\_InOutStateMachine::ioContent}()\textcolor{keyword}{ const}
00024 \textcolor{keyword}{}\{
00025     \textcolor{keywordflow}{return} \hyperlink{classSH__InOutStateMachine_a8cfbc27eef057bf37b7711bdfef2077e}{m\_ioContent};
00026 \}
\hypertarget{SH__IOStateMachine_8cpp_source_l00031}{}\hyperlink{classSH__InOutStateMachine_a8271a7ec7d5f6502449dd3b4da5f4155}{00031} \textcolor{keywordtype}{void} \hyperlink{classSH__InOutStateMachine_a8271a7ec7d5f6502449dd3b4da5f4155}{SH\_InOutStateMachine::setIOcontent}(\textcolor{keyword}{const} QVariantMap &ioContent)
00032 \{
00033     \hyperlink{classSH__InOutStateMachine_a8cfbc27eef057bf37b7711bdfef2077e}{m\_ioContent} = \hyperlink{classSH__InOutStateMachine_aaca105fbd5f5cc3bac115389ad3694c5}{ioContent};
00034 \}
\hypertarget{SH__IOStateMachine_8cpp_source_l00039}{}\hyperlink{classSH__InOutStateMachine_aa1a3bd3c0ea8a59b9bc916dc718eb9ca}{00039} QVariant \hyperlink{classSH__InOutStateMachine_aa1a3bd3c0ea8a59b9bc916dc718eb9ca}{SH\_InOutStateMachine::getContentValue}(QString field)
00040 \{
00041     \textcolor{keywordflow}{return} \hyperlink{classSH__InOutStateMachine_a8cfbc27eef057bf37b7711bdfef2077e}{m\_ioContent}.value(field);
00042 \}
\hypertarget{SH__IOStateMachine_8cpp_source_l00047}{}\hyperlink{classSH__InOutStateMachine_a4288a6c86ddf83effefff886675591c9}{00047} QString \hyperlink{classSH__InOutStateMachine_a4288a6c86ddf83effefff886675591c9}{SH\_InOutStateMachine::tableName}()\textcolor{keyword}{ const}
00048 \textcolor{keyword}{}\{
00049     \textcolor{keywordflow}{return} \hyperlink{classSH__InOutStateMachine_aa009eecc5ab6181358faafb5996b6006}{m\_tableName};
00050 \}
\hypertarget{SH__IOStateMachine_8cpp_source_l00055}{}\hyperlink{classSH__InOutStateMachine_a95db31a7e7f31f36a8737adc739ab08c}{00055} \textcolor{keywordtype}{void} \hyperlink{classSH__InOutStateMachine_a95db31a7e7f31f36a8737adc739ab08c}{SH\_InOutStateMachine::setTableName}(\textcolor{keyword}{const} QString &tableName)
00056 \{
00057     \hyperlink{classSH__InOutStateMachine_aa009eecc5ab6181358faafb5996b6006}{m\_tableName} = \hyperlink{classSH__InOutStateMachine_a4288a6c86ddf83effefff886675591c9}{tableName};
00058 \}
\hypertarget{SH__IOStateMachine_8cpp_source_l00063}{}\hyperlink{classSH__InOutStateMachine_a9ab1534306b2bdb62743d4bcefe40c17}{00063} \textcolor{keywordtype}{void} \hyperlink{classSH__InOutStateMachine_a9ab1534306b2bdb62743d4bcefe40c17}{SH\_InOutStateMachine::setContentValue}(QVariant content, QString 
      field)
00064 \{
00065     \hyperlink{classSH__InOutStateMachine_a8cfbc27eef057bf37b7711bdfef2077e}{m\_ioContent}.insert(field, content);
00066 \}
00067 
\hypertarget{SH__IOStateMachine_8cpp_source_l00068}{}\hyperlink{classSH__InOutStateMachine_a3de9dedcdfd6efab868484c047638f71}{00068} \textcolor{keywordtype}{void} \hyperlink{classSH__InOutStateMachine_a3de9dedcdfd6efab868484c047638f71}{SH\_InOutStateMachine::addState}(QAbstractState *state)
00069 \{
00070     \hyperlink{classSH__MessageManager_a379f2aa0a590a5add34dbe91f98b2ff7}{SH\_MessageManager::debugMessage}(\textcolor{stringliteral}{"chalut"});
00071     \hyperlink{classSH__GenericStateMachine_af4402993e916573a589c9d28158b28d8}{SH\_GenericStateMachine::addState}(state);
00072 \}
00073 
\hypertarget{SH__IOStateMachine_8cpp_source_l00074}{}\hyperlink{classSH__InOutStateMachine_a52469f4988c3eb654def2ed237fd10eb}{00074} \textcolor{keywordtype}{void} \hyperlink{classSH__InOutStateMachine_a3de9dedcdfd6efab868484c047638f71}{SH\_InOutStateMachine::addState}(\hyperlink{classSH__InOutState}{SH\_InOutState} *state, 
      QString field)
00075 \{
00076     \hyperlink{classSH__MessageManager_a379f2aa0a590a5add34dbe91f98b2ff7}{SH\_MessageManager::debugMessage}(\textcolor{stringliteral}{"salioute state"});
00077     \hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{SH\_InOutStateMachine::addIOState}(state, field);
00078 \}
00079 
\hypertarget{SH__IOStateMachine_8cpp_source_l00084}{}\hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{00084} \textcolor{keywordtype}{void} \hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{SH\_InOutStateMachine::addIOState}(
      \hyperlink{classSH__InOutState}{SH\_InOutState} *astate, QString field)
00085 \{
00086     \hyperlink{classSH__InOutState}{SH\_InOutState}* state = qobject\_cast<\hyperlink{classSH__InOutState}{SH\_InOutState} *>(astate);
00087     \textcolor{keywordflow}{if}(state) \{
00088         \textcolor{comment}{/*connect(this, &SH\_GenericStateMachine::entered, [=]() \{*/}
00089         \textcolor{comment}{/*à faire au moment de l'entrée dans l'état state*/}
00090         \textcolor{comment}{/*connect(state, &QAbstractState::entered, [=]() \{*/}
00091         \textcolor{comment}{/* la réception d'une valeur entraîne son enregistrement comme entrée de l'utilisateur auprès de
       l'état*/}
00092         connect(state, &\hyperlink{classSH__InOutState_a77921c5f42059bc97361f4ff7827da12}{SH\_InOutState::sendOutput}, [=](QVariant out) \{ \textcolor{keywordflow}{if}(out.
      isValid()) \{
00093                 \hyperlink{classSH__MessageManager_a0b35c2f96e6d69934bf7f7c1e2172ea9}{SH\_MessageManager::infoMessage}(out.toString(),\textcolor{stringliteral}{"reçu de l'état
      "});
00094                 emit this->\hyperlink{classSH__InOutStateMachine_a5e7f5958bae31696b6a8deab94ad2b4f}{sendText}(out.toString(), \textcolor{keyword}{false});
00095             \}\});
00096         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_a037ed5e13ecfae2123a8d4940292e410}{SH\_InOutStateMachine::receiveInput}, state, &
      \hyperlink{classSH__InOutState_aaec9c2b5ef7c406bff7469461352d47c}{SH\_InOutState::setInput}, Qt::QueuedConnection);
00097         connect(state, &\hyperlink{classSH__InOutState_a1f00480afefd173002cf56d4c4128048}{SH\_InOutState::resendInput}, [=](QVariant in) \{  \textcolor{keywordflow}{if}(in.
      isValid()) \{
00098                 \hyperlink{classSH__MessageManager_a0b35c2f96e6d69934bf7f7c1e2172ea9}{SH\_MessageManager::infoMessage}(in.toString(),\textcolor{stringliteral}{"envoyé par
       l'état"});
00099                 emit this->\hyperlink{classSH__InOutStateMachine_a526822c66b46aa0cd81ba4473fa5573f}{resendText}(in.toString(), \textcolor{keyword}{true});
00100             \}\});
00101         \hyperlink{classSH__MessageManager_a379f2aa0a590a5add34dbe91f98b2ff7}{SH\_MessageManager::debugMessage}(\textcolor{stringliteral}{"salioute"});
00102         \hyperlink{classSH__ValidationState}{SH\_ValidationState} *validationState = qobject\_cast<
      \hyperlink{classSH__ValidationState}{SH\_ValidationState}*>(astate);
00103         \textcolor{keywordflow}{if}(validationState) \{
00104             connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_aec1b3fef3c1f82499aa1f73beaecd08a}{SH\_InOutStateMachine::validateInput}, 
      validationState, &\hyperlink{classSH__ConfirmationState_a039267260de5d102ac7511e6a5fae87f}{SH\_ValidationState::confirmInput}, Qt::QueuedConnection);
00105         \}
00106 
00107         \hyperlink{classSH__ConfirmationState}{SH\_ConfirmationState} *confirmationState = qobject\_cast<
      \hyperlink{classSH__ConfirmationState}{SH\_ConfirmationState}*>(astate);
00108         \textcolor{keywordflow}{if}(confirmationState) \{
00109             connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_aec1b3fef3c1f82499aa1f73beaecd08a}{SH\_InOutStateMachine::validateInput}, 
      confirmationState, &\hyperlink{classSH__ConfirmationState_a039267260de5d102ac7511e6a5fae87f}{SH\_ConfirmationState::confirmInput}, Qt::QueuedConnection);
00110         \}
00111 
00112         \hyperlink{classSH__DateQuestionState}{SH\_DateQuestionState} *dateState = qobject\_cast<
      \hyperlink{classSH__DateQuestionState}{SH\_DateQuestionState}*>(astate);
00113         \textcolor{keywordflow}{if}(dateState) \{
00114             emit this->\hyperlink{classSH__InOutStateMachine_ab3a12d1f9b658d8ffdc17669a6c065f2}{displayCalendar}();
00115         \}
00116 
00117         \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState} *choiceState = qobject\_cast<
      \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}*>(astate);
00118         \textcolor{keywordflow}{if}(choiceState) \{
00119             connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_ab74b981b0aab09067d7479f2b7e79b0b}{SH\_InOutStateMachine::displayChoiceList}, 
      choiceState, &\hyperlink{classSH__DatabaseContentQuestionState_ae1e149ad7ab3d957f3c5df9ef078448b}{SH\_DatabaseContentQuestionState::displayChoiceList}
      , Qt::QueuedConnection);
00120         \}
00121 
00122         \hyperlink{classSH__FileSelectionState}{SH\_FileSelectionState} *fileState = qobject\_cast<
      \hyperlink{classSH__FileSelectionState}{SH\_FileSelectionState}*>(astate);
00123         \textcolor{keywordflow}{if}(fileState) \{
00124             emit this->\hyperlink{classSH__InOutStateMachine_abd206c3bc32bb7690df9c3e1cd546ebc}{displayFileDialog}();
00125         \}
00126         \hyperlink{classSH__MessageManager_a379f2aa0a590a5add34dbe91f98b2ff7}{SH\_MessageManager::debugMessage}(\textcolor{stringliteral}{"salioute bis"});
00127         \textcolor{comment}{/*\});*/}
00128         connect(state, &QAbstractState::exited, [=]() \{
00129             \textcolor{keywordflow}{if}(!field.isEmpty()) \{
00130                 \hyperlink{classSH__InOutStateMachine_a9ab1534306b2bdb62743d4bcefe40c17}{setContentValue}(state->\hyperlink{classSH__InOutState_a4c674a54f41d2e6ef951b22393dcd89f}{rawInput}(), field);
00131 
00132                 \textcolor{comment}{/*gestion de l'historique des états pour pouvoir revenir à l'état state après l'avoir
       quitté*/}
00133                 QHistoryState* hState = \textcolor{keyword}{new} QHistoryState(state);
00134                 \hyperlink{classSH__InOutStateMachine_acbcce2c4300af1634d928b30e5e9be1c}{setIOStateHistory}(hState, field);
00135             \}
00136             \textcolor{comment}{/*plus aucune action sur l'état ne pourra être provoquée par la machine*/}
00137             state->disconnect(\textcolor{keyword}{this});
00138         \});
00139         \textcolor{comment}{/*\});*/}
00140     \}
00141     \hyperlink{classSH__MessageManager_a379f2aa0a590a5add34dbe91f98b2ff7}{SH\_MessageManager::debugMessage}(\textcolor{stringliteral}{"salioute bis bis"});
00142     QAbstractState* abstate = qobject\_cast<QAbstractState *>(astate);
00143     \textcolor{keywordflow}{if}(abstate) \{
00144         \hyperlink{classSH__InOutStateMachine_a3de9dedcdfd6efab868484c047638f71}{SH\_InOutStateMachine::addState}(abstate);
00145     \}
00146 \}
00147 
\hypertarget{SH__IOStateMachine_8cpp_source_l00152}{}\hyperlink{classSH__InOutStateMachine_adcd6eb72b60b2c24aa6701977b5c7c1e}{00152} \textcolor{keywordtype}{void} \hyperlink{classSH__InOutStateMachine_a3de9dedcdfd6efab868484c047638f71}{SH\_InOutStateMachine::addState}(
      \hyperlink{classSH__InOutStateMachine}{SH\_InOutStateMachine} *fsm, QString table)
00153 \{
00154     \hyperlink{classSH__InOutStateMachine_a0814df2e3f2b776ba210f98cd05be70d}{SH\_InOutStateMachine::addStateMachine}(fsm, table);
00155 \}
00156 
\hypertarget{SH__IOStateMachine_8cpp_source_l00157}{}\hyperlink{classSH__InOutStateMachine_a0814df2e3f2b776ba210f98cd05be70d}{00157} \textcolor{keywordtype}{void} \hyperlink{classSH__InOutStateMachine_a0814df2e3f2b776ba210f98cd05be70d}{SH\_InOutStateMachine::addStateMachine}(
      \hyperlink{classSH__InOutStateMachine}{SH\_InOutStateMachine} *astate, QString table) \{
00158     \hyperlink{classSH__MessageManager_a379f2aa0a590a5add34dbe91f98b2ff7}{SH\_MessageManager::debugMessage}(\textcolor{stringliteral}{"salioute machine"});
00159     \hyperlink{classSH__InOutStateMachine}{SH\_InOutStateMachine}* fsm = qobject\_cast<
      \hyperlink{classSH__InOutStateMachine}{SH\_InOutStateMachine} *>(astate);
00160     \textcolor{keywordflow}{if}(fsm) \{
00161         \textcolor{keywordflow}{if}(!table.isEmpty()) \{
00162             fsm->\hyperlink{classSH__InOutStateMachine_a95db31a7e7f31f36a8737adc739ab08c}{setTableName}(table);
00163         \}
00164         \textcolor{comment}{/*connect(this, &SH\_InOutStateMachine::entered, [=]() \{*/}
00165         \textcolor{comment}{/*à faire au moment de l'entrée dans la machine d'état fsm*/}
00166         \textcolor{comment}{/*connect(fsm, &SH\_InOutStateMachine::entered, [=]() \{*/}
00167         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_a037ed5e13ecfae2123a8d4940292e410}{SH\_InOutStateMachine::receiveInput}, fsm, &
      \hyperlink{classSH__InOutStateMachine_a037ed5e13ecfae2123a8d4940292e410}{SH\_InOutStateMachine::receiveInput},Qt::QueuedConnection);
00168         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_a5e7f5958bae31696b6a8deab94ad2b4f}{SH\_InOutStateMachine::sendText}, fsm, &
      \hyperlink{classSH__InOutStateMachine_a5e7f5958bae31696b6a8deab94ad2b4f}{SH\_InOutStateMachine::sendText},Qt::QueuedConnection);
00169         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_a526822c66b46aa0cd81ba4473fa5573f}{SH\_InOutStateMachine::resendText}, fsm, &
      \hyperlink{classSH__InOutStateMachine_a526822c66b46aa0cd81ba4473fa5573f}{SH\_InOutStateMachine::resendText},Qt::QueuedConnection);
00170         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_a7f7d9c9300c1d05bce2c26029f28cc31}{SH\_InOutStateMachine::confirmInput}, fsm, &
      \hyperlink{classSH__InOutStateMachine_a7f7d9c9300c1d05bce2c26029f28cc31}{SH\_InOutStateMachine::confirmInput},Qt::QueuedConnection);
00171         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_aec1b3fef3c1f82499aa1f73beaecd08a}{SH\_InOutStateMachine::validateInput}, fsm, &
      \hyperlink{classSH__InOutStateMachine_aec1b3fef3c1f82499aa1f73beaecd08a}{SH\_InOutStateMachine::validateInput},Qt::QueuedConnection);
00172         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_a9fa5db44086de2576c812f631aa4f60a}{SH\_InOutStateMachine::replaceInput}, fsm, &
      \hyperlink{classSH__InOutStateMachine_a9fa5db44086de2576c812f631aa4f60a}{SH\_InOutStateMachine::replaceInput},Qt::QueuedConnection);
00173         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_a035d37535533d4805fe2606f38c19380}{SH\_InOutStateMachine::cancelReplacement}, fsm,
       &\hyperlink{classSH__InOutStateMachine_a035d37535533d4805fe2606f38c19380}{SH\_InOutStateMachine::cancelReplacement},Qt::QueuedConnection);
00174         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_ab3a12d1f9b658d8ffdc17669a6c065f2}{SH\_InOutStateMachine::displayCalendar}, fsm, &
      \hyperlink{classSH__InOutStateMachine_ab3a12d1f9b658d8ffdc17669a6c065f2}{SH\_InOutStateMachine::displayCalendar},Qt::QueuedConnection);
00175         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_ab74b981b0aab09067d7479f2b7e79b0b}{SH\_InOutStateMachine::displayChoiceList}, fsm,
       &\hyperlink{classSH__InOutStateMachine_ab74b981b0aab09067d7479f2b7e79b0b}{SH\_InOutStateMachine::displayChoiceList},Qt::QueuedConnection);
00176         \textcolor{comment}{/* \});*/}
00177 
00178         \textcolor{comment}{/*à faire au moment de la sortie de la machine d'état fsm*/}
00179         \textcolor{comment}{/*connect(fsm, &SH\_InOutStateMachine::exited, [=]() \{*/}
00180         \textcolor{comment}{/*plus aucune action sur la machine d'état fille ne pourra être provoquée par la machine mère*/}
00181         \textcolor{comment}{/*fsm->disconnect(this);*/}
00182         \textcolor{comment}{/*\});*/}
00183         \textcolor{comment}{/*\});*/}
00184     \}
00185     QAbstractState* abstate = qobject\_cast<QAbstractState *>(astate);
00186     \textcolor{keywordflow}{if}(abstate) \{
00187         \hyperlink{classSH__InOutStateMachine_a3de9dedcdfd6efab868484c047638f71}{SH\_InOutStateMachine::addState}(abstate);
00188     \}
00189 \}
\hypertarget{SH__IOStateMachine_8cpp_source_l00194}{}\hyperlink{classSH__InOutStateMachine_a13889998c6dcd17db984dd6ed1454e80}{00194} QMap<QString, QHistoryState *> \hyperlink{classSH__InOutStateMachine_a13889998c6dcd17db984dd6ed1454e80}{SH\_InOutStateMachine::ioStatesHistory}()\textcolor{keyword}{
       const}
00195 \textcolor{keyword}{}\{
00196     \textcolor{keywordflow}{return} \hyperlink{classSH__InOutStateMachine_ac46ad1af230e1b2156d805275690dec3}{m\_ioStatesHistory};
00197 \}
\hypertarget{SH__IOStateMachine_8cpp_source_l00202}{}\hyperlink{classSH__InOutStateMachine_af51f92c37d00a4eec4da42113cfd7d73}{00202} \textcolor{keywordtype}{void} \hyperlink{classSH__InOutStateMachine_af51f92c37d00a4eec4da42113cfd7d73}{SH\_InOutStateMachine::setIOStatesHistory}(\textcolor{keyword}{const} QMap<QString,
       QHistoryState *> &ioStatesHistory)
00203 \{
00204     \hyperlink{classSH__InOutStateMachine_ac46ad1af230e1b2156d805275690dec3}{m\_ioStatesHistory} = \hyperlink{classSH__InOutStateMachine_a13889998c6dcd17db984dd6ed1454e80}{ioStatesHistory};
00205 \}
\hypertarget{SH__IOStateMachine_8cpp_source_l00210}{}\hyperlink{classSH__InOutStateMachine_acbcce2c4300af1634d928b30e5e9be1c}{00210} \textcolor{keywordtype}{void} \hyperlink{classSH__InOutStateMachine_acbcce2c4300af1634d928b30e5e9be1c}{SH\_InOutStateMachine::setIOStateHistory}(QHistoryState *state, 
      QString field)
00211 \{
00212     \textcolor{comment}{/*remplacement si plusieurs fois, ajout sinon*/}
00213     \hyperlink{classSH__InOutStateMachine_ac46ad1af230e1b2156d805275690dec3}{m\_ioStatesHistory}.insert(field, state);
00214 \}
\hypertarget{SH__IOStateMachine_8cpp_source_l00219}{}\hyperlink{classSH__InOutStateMachine_af71bfdb3b59b7bf2763588b513b4205f}{00219} QHistoryState *\hyperlink{classSH__InOutStateMachine_af71bfdb3b59b7bf2763588b513b4205f}{SH\_InOutStateMachine::historyValue}(QString field)
00220 \{
00221     \textcolor{keywordflow}{return} \hyperlink{classSH__InOutStateMachine_ac46ad1af230e1b2156d805275690dec3}{m\_ioStatesHistory}.value(field);
00222 \}
\hypertarget{SH__IOStateMachine_8cpp_source_l00227}{}\hyperlink{classSH__InOutStateMachine_ae0f3b4622d2c70884bb224dee86e95c0}{00227} \textcolor{keywordtype}{void} \hyperlink{classSH__InOutStateMachine_ae0f3b4622d2c70884bb224dee86e95c0}{SH\_InOutStateMachine::addChildrenReplaceTransition}(
      QAbstractState *previousState, QAbstractState *nextState)
00228 \{
00229     \hyperlink{classSH__GenericState}{SH\_GenericState}* genPreviousState = qobject\_cast<
      \hyperlink{classSH__GenericState}{SH\_GenericState}*>(previousState);
00230     \textcolor{keywordflow}{if}(genPreviousState) \{
00231         \textcolor{comment}{/*connect(this, &SH\_GenericStateMachine::entered, [=]() \{*/}
00232         \textcolor{comment}{/*à faire au moment de l'entrée dans l'état previousState*/}
00233         \textcolor{comment}{/*connect(genPreviousState, &QAbstractState::entered, [=]() \{*/}
00234         connect(\textcolor{keyword}{this}, &\hyperlink{classSH__InOutStateMachine_a9fa5db44086de2576c812f631aa4f60a}{SH\_InOutStateMachine::replaceInput}, [=](QString 
      field) \{
00235             \textcolor{comment}{/*après avoir demandé à revenir sur un état précédent, on attend la fin de l'état actuel puis
       on retourne à l'historique de l'état désiré; celui-ci fini, on passe à l'état qui aurait du suivre celui
       pendant lequel on a demandé à revenir sur un état précédent*/}
00236             QHistoryState* hState = \hyperlink{classSH__InOutStateMachine_af71bfdb3b59b7bf2763588b513b4205f}{historyValue}(field);
00237             \textcolor{keywordflow}{if}(hState) \{
00238                 \textcolor{comment}{/*si l'historique existe (on a déjà quitté l'état voulu)*/}
00239                 hState->parentState()->addTransition(hState->parentState(), SIGNAL(
      \hyperlink{classSH__GenericStateMachine_af4771d31d87951c997fba1633c2d67f6}{next}()), nextState);
00240                 genPreviousState->addTransition(genPreviousState, SIGNAL(\hyperlink{classSH__GenericStateMachine_af4771d31d87951c997fba1633c2d67f6}{next}()), hState);
00241             \}
00242         \});
00243         \textcolor{comment}{/*\});*/}
00244         \textcolor{comment}{/*\});*/}
00245     \}
00246 \}
\hypertarget{SH__IOStateMachine_8cpp_source_l00251}{}\hyperlink{classSH__InOutStateMachine_a70d6d81c0a8d4afd6aab0a7239edc237}{00251} \textcolor{keywordtype}{void} \hyperlink{classSH__InOutStateMachine_a70d6d81c0a8d4afd6aab0a7239edc237}{SH\_InOutStateMachine::setStatesNextTransition}(
      QAbstractState *previousState, QAbstractState *nextState)
00252 \{
00253     \hyperlink{classSH__GenericStateMachine}{SH\_GenericStateMachine}* fsmPreviousState = qobject\_cast<
      \hyperlink{classSH__GenericStateMachine}{SH\_GenericStateMachine}*>(previousState);
00254     \hyperlink{classSH__GenericState}{SH\_GenericState}* genPreviousState = qobject\_cast<
      \hyperlink{classSH__GenericState}{SH\_GenericState}*>(previousState);
00255     QFinalState* \textcolor{keyword}{final} = qobject\_cast<QFinalState*>(nextState);
00256     \textcolor{keywordflow}{if}(\textcolor{keyword}{final}) \{
00257         \hyperlink{classSH__AdaptDatabaseState}{SH\_AdaptDatabaseState}* saveState = \textcolor{keyword}{new} 
      \hyperlink{classSH__AdaptDatabaseState}{SH\_AdaptDatabaseState}(\textcolor{stringliteral}{"enregistrement de la machine "}+
      \hyperlink{classSH__GenericStateMachine_a85c0c1c9d258ae991f84667412fa47cd}{toString}());
00258         \textcolor{keywordflow}{if}(genPreviousState) \{
00259             \textcolor{comment}{/*connect(this, &SH\_GenericStateMachine::entered, [=]() \{*/}
00260             connect(genPreviousState, &QAbstractState::exited, [=]() \{
00261                 emit this->\hyperlink{classSH__InOutStateMachine_a5e7f5958bae31696b6a8deab94ad2b4f}{sendText}(\textcolor{stringliteral}{"Merci !"});
00262                 \hyperlink{classSH__InOutStateMachine_a9ab1534306b2bdb62743d4bcefe40c17}{setContentValue}(saveState->\hyperlink{classSH__AdaptDatabaseState_a037db544ea05f42d21fcbdda758839fe}{insertUpdate}(
      \hyperlink{classSH__InOutStateMachine_aa009eecc5ab6181358faafb5996b6006}{m\_tableName}, \hyperlink{classSH__InOutStateMachine_a8cfbc27eef057bf37b7711bdfef2077e}{m\_ioContent}), \textcolor{stringliteral}{"ID"});
00263             \});
00264             \textcolor{comment}{/*\});*/}
00265         \}
00266         \textcolor{keywordflow}{if}(fsmPreviousState) \{
00267             \textcolor{comment}{/*connect(this, &SH\_GenericStateMachine::entered, [=]() \{*/}
00268             connect(genPreviousState, &QAbstractState::exited, [=]() \{
00269                 emit this->\hyperlink{classSH__InOutStateMachine_a5e7f5958bae31696b6a8deab94ad2b4f}{sendText}(\textcolor{stringliteral}{"Merci !"});
00270                 \hyperlink{classSH__InOutStateMachine_a9ab1534306b2bdb62743d4bcefe40c17}{setContentValue}(saveState->\hyperlink{classSH__AdaptDatabaseState_a037db544ea05f42d21fcbdda758839fe}{insertUpdate}(
      \hyperlink{classSH__InOutStateMachine_aa009eecc5ab6181358faafb5996b6006}{m\_tableName}, \hyperlink{classSH__InOutStateMachine_a8cfbc27eef057bf37b7711bdfef2077e}{m\_ioContent}), \textcolor{stringliteral}{"ID"});
00271             \});
00272             \textcolor{comment}{/*\});*/}
00273         \}
00274         \textcolor{keywordflow}{if}(genPreviousState || fsmPreviousState) \{
00275             \textcolor{comment}{/*connect(this, &SH\_GenericStateMachine::entered, [=]() \{*/}
00276             connect(saveState, &QAbstractState::exited, [=]() \{
00277                 emit this->\hyperlink{classSH__InOutStateMachine_aa1d5860888c96ff94c55dc77e0fdfdcf}{clearAll}();
00278             \});
00279             \textcolor{comment}{/*\});*/}
00280         \}
00281         \hyperlink{classSH__GenericStateMachine_a136a71cd1f2de1322ac7694db25f0b53}{SH\_GenericStateMachine::setStatesNextTransition}(
      previousState, saveState);
00282         \hyperlink{classSH__GenericStateMachine_a136a71cd1f2de1322ac7694db25f0b53}{SH\_GenericStateMachine::setStatesNextTransition}(
      saveState, \textcolor{keyword}{final});
00283     \} \textcolor{keywordflow}{else} \{
00284         \hyperlink{classSH__GenericStateMachine_a136a71cd1f2de1322ac7694db25f0b53}{SH\_GenericStateMachine::setStatesNextTransition}(
      previousState, nextState);
00285     \}
00286 \}
00287 \textcolor{comment}{/*\}*/}
\end{DoxyCode}
