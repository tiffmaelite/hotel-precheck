\hypertarget{SH__ExtendedProxyModel_8cpp}{\section{S\-H\-\_\-\-Extended\-Proxy\-Model.\-cpp}
\label{SH__ExtendedProxyModel_8cpp}\index{/home/tiff/\-Stage-\/\-I\-U\-T/app/simplhotel/hotel-\/precheck/src/\-Pre\-Check/models/\-S\-H\-\_\-\-Extended\-Proxy\-Model.\-cpp@{/home/tiff/\-Stage-\/\-I\-U\-T/app/simplhotel/hotel-\/precheck/src/\-Pre\-Check/models/\-S\-H\-\_\-\-Extended\-Proxy\-Model.\-cpp}}
}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include <QtSql/QSqlRecord>}
00002 \textcolor{preprocessor}{#include <QDebug>}
00003 \textcolor{preprocessor}{#include "\hyperlink{SH__ExtendedSqlProxyModel_8h}{SH\_ExtendedSqlProxyModel.h}"}
00004 \textcolor{preprocessor}{#include "\hyperlink{SH__MessageManager_8h}{SH\_MessageManager.h}"}
00005 
00006 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00012}{}\hyperlink{classSH__ExtendedProxyModel_a63b0969a9f5799c9e871e6ceb13cf83e}{00012} \hyperlink{classSH__ExtendedProxyModel_a63b0969a9f5799c9e871e6ceb13cf83e}{SH\_ExtendedProxyModel::SH\_ExtendedProxyModel}(
      \hyperlink{classQObject}{QObject} *parent) :
00013     \hyperlink{classQSortFilterProxyModel}{QSortFilterProxyModel}(parent)
00014 \{
00015     this->setDynamicSortFilter(\textcolor{keyword}{false});
00016     this->\hyperlink{classSH__ExtendedProxyModel_a8c8b8930c6b1abd9bbb1dce1fdc9690b}{model} = \textcolor{keyword}{new} \hyperlink{classSH__SqlDataModel}{SH\_SqlDataModel}(parent);
00017     this->setSourceModel(this->\hyperlink{classSH__ExtendedProxyModel_a8c8b8930c6b1abd9bbb1dce1fdc9690b}{model});
00018     this->\hyperlink{classSH__ExtendedProxyModel_a83cabe4cf90a26d26c4aaa40e944b2bd}{sortIndex} = 0;
00019     \textcolor{comment}{/*connect(this->model, tableChanged(), tableName());*/}
00020 \}
00021 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00027}{}\hyperlink{classSH__ExtendedProxyModel_abb0f0b100df006c1c2646833a444b734}{00027} \textcolor{keywordtype}{void} \hyperlink{classSH__ExtendedProxyModel_abb0f0b100df006c1c2646833a444b734}{SH\_ExtendedProxyModel::replaceSet}(QList<int>& originalSet, QList<int>
       newSet) \{
00028     originalSet.clear();
00029     \textcolor{keywordflow}{foreach}(\textcolor{keywordtype}{int} col, newSet) \{
00030         \textcolor{keywordflow}{if}(!originalSet.contains(col)) \{
00031             originalSet.append(col);
00032         \}
00033     \}
00034 \}
00035 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00041}{}\hyperlink{classSH__ExtendedProxyModel_a2acefd1604abfef312fdaa65e57c2234}{00041} \textcolor{keywordtype}{void} \hyperlink{classSH__ExtendedProxyModel_a2acefd1604abfef312fdaa65e57c2234}{SH\_ExtendedProxyModel::setBooleanColumns}(QList<int> boolCols) 
      \{
00042     \hyperlink{classSH__ExtendedProxyModel_abb0f0b100df006c1c2646833a444b734}{replaceSet}(this->\hyperlink{classSH__ExtendedProxyModel_a7dd9cf1dd153b98220d217e9be1f0916}{booleanSet}, boolCols);
00043 \}
00044 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00050}{}\hyperlink{classSH__ExtendedProxyModel_a985d27d4f35a303e0cd453a05910da1d}{00050} \textcolor{keywordtype}{void} \hyperlink{classSH__ExtendedProxyModel_a985d27d4f35a303e0cd453a05910da1d}{SH\_ExtendedProxyModel::setReadOnlyColumns}(QList<int> 
      readonlyCols) \{
00051     \hyperlink{classSH__ExtendedProxyModel_abb0f0b100df006c1c2646833a444b734}{replaceSet}(this->\hyperlink{classSH__ExtendedProxyModel_ad8e1da8be7d34eefe243a7707be8b166}{readonlySet}, readonlyCols);
00052 \}
00053 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00059}{}\hyperlink{classSH__ExtendedProxyModel_a4bbea95e7483aeeef4709c12e5ef61c5}{00059} \textcolor{keywordtype}{void} \hyperlink{classSH__ExtendedProxyModel_a4bbea95e7483aeeef4709c12e5ef61c5}{SH\_ExtendedProxyModel::setPasswordColumns}(QList<int> 
      passwordCols) \{
00060     \hyperlink{classSH__ExtendedProxyModel_abb0f0b100df006c1c2646833a444b734}{replaceSet}(this->\hyperlink{classSH__ExtendedProxyModel_a9616e7be442b560e260e1db9034143bc}{passwordSet}, passwordCols);
00061 \}
00062 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00068}{}\hyperlink{classSH__ExtendedProxyModel_a2a5734c26bb72fb11e50b9036914d987}{00068} \textcolor{keywordtype}{void} \hyperlink{classSH__ExtendedProxyModel_a2a5734c26bb72fb11e50b9036914d987}{SH\_ExtendedProxyModel::setNullColumns}(QList<int> nullCols) \{
00069     \textcolor{keywordflow}{if} (sourceModel()->inherits(\textcolor{stringliteral}{"QSqlQueryModel"})) \{
00070         \hyperlink{classSH__ExtendedProxyModel_abb0f0b100df006c1c2646833a444b734}{replaceSet}(this->\hyperlink{classSH__ExtendedProxyModel_a0a3818c6f8e4b73d1b5b47b2914cb56d}{nullSet}, nullCols);
00071     \}
00072 \}
00073 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00080}{}\hyperlink{classSH__ExtendedProxyModel_a9211b1bc09442298367565d7e0f62de4}{00080} \textcolor{keywordtype}{void} \hyperlink{classSH__ExtendedProxyModel_a9211b1bc09442298367565d7e0f62de4}{SH\_ExtendedProxyModel::setNotNullColumns}(QList<int> 
      notNullCols) \{
00081     \textcolor{keywordflow}{if} (sourceModel()->inherits(\textcolor{stringliteral}{"QSqlQueryModel"})) \{
00082         \hyperlink{classSH__ExtendedProxyModel_abb0f0b100df006c1c2646833a444b734}{replaceSet}(this->\hyperlink{classSH__ExtendedProxyModel_ac17eb2c65d47f6dc6dd322e0a39bbe3e}{notNullSet}, notNullCols);
00083     \}
00084 \}
00085 
00086 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00092}{}\hyperlink{classSH__ExtendedProxyModel_a1eda169699702a7bfed4dfa8718c0b86}{00092} \textcolor{keywordtype}{bool} \hyperlink{classSH__ExtendedProxyModel_a1eda169699702a7bfed4dfa8718c0b86}{SH\_ExtendedProxyModel::filterAcceptsRow}(\textcolor{keywordtype}{int} source\_row, \textcolor{keyword}{const} 
      QModelIndex &source\_parent)\textcolor{keyword}{ const}
00093 \textcolor{keyword}{}\{
00094     Q\_UNUSED(source\_parent);
00095 
00096     \textcolor{keywordflow}{if} (!this->\hyperlink{classSH__ExtendedProxyModel_ac17eb2c65d47f6dc6dd322e0a39bbe3e}{notNullSet}.isEmpty())
00097     \{
00098         QSqlQueryModel *m = \textcolor{keyword}{static\_cast<}QSqlQueryModel *\textcolor{keyword}{>}(sourceModel());
00099         \textcolor{keywordflow}{foreach}(\textcolor{keywordtype}{int} column, this->\hyperlink{classSH__ExtendedProxyModel_ac17eb2c65d47f6dc6dd322e0a39bbe3e}{notNullSet})
00100         \{
00101             \textcolor{keywordflow}{if} (m->record(source\_row).isNull(column))
00102             \{
00103                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00104             \}
00105         \}
00106     \}
00107 
00108     \textcolor{keywordflow}{if} (!this->\hyperlink{classSH__ExtendedProxyModel_a0a3818c6f8e4b73d1b5b47b2914cb56d}{nullSet}.isEmpty())
00109     \{
00110         QSqlQueryModel *m = \textcolor{keyword}{static\_cast<}QSqlQueryModel *\textcolor{keyword}{>}(sourceModel());
00111         \textcolor{keywordflow}{foreach}(\textcolor{keywordtype}{int} column, this->\hyperlink{classSH__ExtendedProxyModel_a0a3818c6f8e4b73d1b5b47b2914cb56d}{nullSet})
00112         \{
00113             \textcolor{keywordflow}{if} (!m->record(source\_row).isNull(column))
00114             \{
00115                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00116             \}
00117         \}
00118     \}
00119     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00120 \}
00121 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00127}{}\hyperlink{classSH__ExtendedProxyModel_afbc947efbe1107fc5bf8926c52902a1c}{00127} QVariant \hyperlink{classSH__ExtendedProxyModel_aca6cc510f740e847e0cfc06e0adb5771}{SH\_ExtendedProxyModel::data}(\textcolor{keyword}{const} QModelIndex &index, \textcolor{keywordtype}{int} role)\textcolor{keyword}{ const}
00128 \textcolor{keyword}{}\{
00129     \textcolor{keywordflow}{if} (index.isValid())
00130     \{
00131         \textcolor{keywordflow}{if} (this->\hyperlink{classSH__ExtendedProxyModel_a7dd9cf1dd153b98220d217e9be1f0916}{booleanSet}.contains(role))
00132         \{
00133             \textcolor{keywordflow}{return} index.data(Qt::EditRole).toBool() ? QVariant(Qt::Checked) : QVariant(Qt::Unchecked);
00134         \}
00135         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (this->\hyperlink{classSH__ExtendedProxyModel_a9616e7be442b560e260e1db9034143bc}{passwordSet}.contains(role))
00136         \{
00137             \textcolor{keywordflow}{return} QVariant(\textcolor{stringliteral}{"***"});
00138         \}
00139         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!this->\hyperlink{classSH__ExtendedProxyModel_a99a5c4c6b9d125c87f048c76d22278d3}{filters}.contains(role))
00140         \{
00141             QModelIndex source\_index = QSortFilterProxyModel::mapToSource(index);
00142             \textcolor{keywordflow}{if} (source\_index.isValid()) \{
00143                 \textcolor{keywordflow}{return} this->\hyperlink{classSH__ExtendedProxyModel_a8c8b8930c6b1abd9bbb1dce1fdc9690b}{model}->\hyperlink{classSH__SqlDataModel_aa4664329d52c2d2cba2bacc42fa1a564}{data}(source\_index, role);
00144             \}
00145         \}
00146     \}
00147     \textcolor{keywordflow}{return} QVariant();
00148 \}
00149 
00150 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00156}{}\hyperlink{classSH__ExtendedProxyModel_aaaddcc27fdce4ef70f242460b8e053da}{00156} \textcolor{keywordtype}{bool} \hyperlink{classSH__ExtendedProxyModel_aaaddcc27fdce4ef70f242460b8e053da}{SH\_ExtendedProxyModel::setData}(\textcolor{keyword}{const} QModelIndex &index, \textcolor{keyword}{const} QVariant 
      &value, \textcolor{keywordtype}{int} role)
00157 \{
00158     \textcolor{keywordflow}{if} (!index.isValid())
00159         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00160 
00161     \textcolor{keywordflow}{if} (this->\hyperlink{classSH__ExtendedProxyModel_a7dd9cf1dd153b98220d217e9be1f0916}{booleanSet}.contains(role))
00162     \{
00163         QVariant \hyperlink{classSH__ExtendedProxyModel_aca6cc510f740e847e0cfc06e0adb5771}{data} = (value.toInt() == Qt::Checked) ? QVariant(1) : QVariant(0);
00164         \textcolor{keywordflow}{return} QSortFilterProxyModel::setData(index, data, role);
00165     \}
00166     \textcolor{keywordflow}{else}
00167     \{
00168         \textcolor{keywordflow}{return} QSortFilterProxyModel::setData(index, value, role);
00169     \}
00170 
00171 \}
00172 
00173 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00179}{}\hyperlink{classSH__ExtendedProxyModel_aa12f3d989293da24fb47fd96a080cdc0}{00179} Qt::ItemFlags \hyperlink{classSH__ExtendedProxyModel_aa12f3d989293da24fb47fd96a080cdc0}{SH\_ExtendedProxyModel::flags}(\textcolor{keyword}{const} QModelIndex &index)\textcolor{keyword}{ const}
00180 \textcolor{keyword}{}\{
00181     \textcolor{keywordflow}{if} (!index.isValid())
00182     \{
00183         \textcolor{keywordflow}{return} Qt::ItemIsEnabled;
00184     \}
00185     \textcolor{keywordflow}{if} (!this->\hyperlink{classSH__ExtendedProxyModel_a7dd9cf1dd153b98220d217e9be1f0916}{booleanSet}.isEmpty())
00186     \{
00187         \textcolor{keywordflow}{return} Qt::ItemIsUserCheckable | Qt::ItemIsSelectable | Qt::ItemIsEnabled;
00188     \}
00189     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!this->\hyperlink{classSH__ExtendedProxyModel_ad8e1da8be7d34eefe243a7707be8b166}{readonlySet}.isEmpty())
00190     \{
00191         \textcolor{keywordflow}{return} Qt::ItemIsSelectable;
00192     \}
00193     \textcolor{keywordflow}{else}
00194     \{
00195         \textcolor{keywordflow}{return} QSortFilterProxyModel::flags(index);
00196     \}
00197 
00198 \}
00199 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00205}{}\hyperlink{classSH__ExtendedProxyModel_a7cfb1803f839023c7ba6fc67b900d76a}{00205} \textcolor{keywordtype}{void} \hyperlink{classSH__ExtendedProxyModel_a7cfb1803f839023c7ba6fc67b900d76a}{SH\_ExtendedProxyModel::invalidateFilter}()
00206 \{
00207     this->\hyperlink{classSH__ExtendedProxyModel_a99a5c4c6b9d125c87f048c76d22278d3}{filters}.clear();
00208 \}
00209 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00215}{}\hyperlink{classSH__ExtendedProxyModel_a631c2a56b4a301b9c8a855facec3ac1c}{00215} \textcolor{keywordtype}{void} \hyperlink{classSH__ExtendedProxyModel_a631c2a56b4a301b9c8a855facec3ac1c}{SH\_ExtendedProxyModel::removeFilterKeyColumn}(\textcolor{keywordtype}{int} column)
00216 \{
00217     this->\hyperlink{classSH__ExtendedProxyModel_a99a5c4c6b9d125c87f048c76d22278d3}{filters}.removeAt(this->\hyperlink{classSH__ExtendedProxyModel_a99a5c4c6b9d125c87f048c76d22278d3}{filters}.indexOf(column));
00218 \}
00219 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00225}{}\hyperlink{classSH__ExtendedProxyModel_a81c40d3ce9710029cae19cc65bf5419d}{00225} \textcolor{keywordtype}{bool} \hyperlink{classSH__ExtendedProxyModel_a81c40d3ce9710029cae19cc65bf5419d}{SH\_ExtendedProxyModel::containsFilterKeyColumn}(\textcolor{keywordtype}{int} 
      column)
00226 \{
00227     \textcolor{keywordflow}{return} this->\hyperlink{classSH__ExtendedProxyModel_a99a5c4c6b9d125c87f048c76d22278d3}{filters}.contains(column);
00228 \}
00229 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00235}{}\hyperlink{classSH__ExtendedProxyModel_a2d5fdb58bf67879e3f3130619b93104a}{00235} \textcolor{keywordtype}{void} \hyperlink{classSH__ExtendedProxyModel_a2d5fdb58bf67879e3f3130619b93104a}{SH\_ExtendedProxyModel::sort}(\textcolor{keywordtype}{int} column, Qt::SortOrder newOrder)
00236 \{
00237     this->\hyperlink{classSH__ExtendedProxyModel_a8c8b8930c6b1abd9bbb1dce1fdc9690b}{model}->\hyperlink{classSH__SqlDataModel_a92c51d5c1f6aca08a7ee566ece1e4cb6}{field}(column)->\hyperlink{classSH__SqlDataFields_a32a7c040a081d39594245e1a4a68f70d}{setSortOrder}(newOrder);
00238     \hyperlink{classSH__ExtendedProxyModel_ab8123244a5060aa35f5bce651046b99d}{SH\_ExtendedProxyModel::setSortKeyColumn}(column);
00239 \}
00240 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00246}{}\hyperlink{classSH__ExtendedProxyModel_ab8123244a5060aa35f5bce651046b99d}{00246} \textcolor{keywordtype}{void} \hyperlink{classSH__ExtendedProxyModel_ab8123244a5060aa35f5bce651046b99d}{SH\_ExtendedProxyModel::setSortKeyColumn}(\textcolor{keywordtype}{int} column)
00247 \{
00248     this->\hyperlink{classSH__ExtendedProxyModel_a83cabe4cf90a26d26c4aaa40e944b2bd}{sortIndex} = column;
00249     QSortFilterProxyModel::setSortRole(this->\hyperlink{classSH__ExtendedProxyModel_a8c8b8930c6b1abd9bbb1dce1fdc9690b}{model}->\hyperlink{classSH__SqlDataModel_aa487bb763eaf2544e4eb5822cd666105}{roleForField}(column));
00250     QSortFilterProxyModel::sort(0, this->\hyperlink{classSH__ExtendedProxyModel_a8c8b8930c6b1abd9bbb1dce1fdc9690b}{model}->\hyperlink{classSH__SqlDataModel_a92c51d5c1f6aca08a7ee566ece1e4cb6}{field}(column)->
      \hyperlink{classSH__SqlDataFields_a67b20d296535d6b9dda6c85f75427ad1}{sortOrder}());
00251     emit \hyperlink{classSH__ExtendedProxyModel_ad34f69425d6c86a2671cf9f85562a724}{sortChanged}();
00252 \}
00253 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00259}{}\hyperlink{classSH__ExtendedProxyModel_a7b432fac5c42bf84a005f2942896ca32}{00259} \textcolor{keywordtype}{void} \hyperlink{classSH__ExtendedProxyModel_a7b432fac5c42bf84a005f2942896ca32}{SH\_ExtendedProxyModel::addFilterKeyColumn}(\textcolor{keywordtype}{int} column)
00260 \{
00261     this->\hyperlink{classSH__ExtendedProxyModel_a99a5c4c6b9d125c87f048c76d22278d3}{filters}.append(column);
00262 \}
00263 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00269}{}\hyperlink{classSH__ExtendedProxyModel_aca6cc510f740e847e0cfc06e0adb5771}{00269} QVariant \hyperlink{classSH__ExtendedProxyModel_aca6cc510f740e847e0cfc06e0adb5771}{SH\_ExtendedProxyModel::data}(\textcolor{keywordtype}{int} row, \textcolor{keywordtype}{int} column)\textcolor{keyword}{ const}
00270 \textcolor{keyword}{}\{
00271     QModelIndex modelIndex = this->index(row, 0);
00272     \textcolor{keywordflow}{return} this->\hyperlink{classSH__ExtendedProxyModel_aca6cc510f740e847e0cfc06e0adb5771}{data}(modelIndex, this->\hyperlink{classSH__ExtendedProxyModel_a8c8b8930c6b1abd9bbb1dce1fdc9690b}{model}->\hyperlink{classSH__SqlDataModel_aa487bb763eaf2544e4eb5822cd666105}{roleForField}(column));
00273 \}
00274 
\hypertarget{SH__ExtendedProxyModel_8cpp_source_l00280}{}\hyperlink{classSH__ExtendedProxyModel_a1df5323af8d29e81f22a7118227eeeb8}{00280} \textcolor{keywordtype}{bool} \hyperlink{classSH__ExtendedProxyModel_a1df5323af8d29e81f22a7118227eeeb8}{SH\_ExtendedProxyModel::fetch}(QString tableName, QString filter, QString 
      sort, QStringList fields)
00281 \{
00282     \textcolor{keywordtype}{bool} fetched = this->\hyperlink{classSH__ExtendedProxyModel_a8c8b8930c6b1abd9bbb1dce1fdc9690b}{model}->\hyperlink{classSH__SqlDataModel_ab6c206088250a66ddc8cb8d33a38e421}{fetch}(tableName, filter, sort, fields);
00283     \textcolor{keywordflow}{if} (fetched)
00284     \{
00285         this->\hyperlink{classSH__ExtendedProxyModel_ad6b7ea810aa00f42624253d77caafcbb}{fillModel}();
00286     \}
00287     this->setSourceModel(this->\hyperlink{classSH__ExtendedProxyModel_a8c8b8930c6b1abd9bbb1dce1fdc9690b}{model});
00288     \textcolor{keywordflow}{return} fetched;
00289 \}
00290 
00291 
00292 
\end{DoxyCode}
