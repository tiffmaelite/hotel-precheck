\hypertarget{SH__ApplicationCore_8cpp_source}{\section{S\-H\-\_\-\-Application\-Core.\-cpp}
}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "\hyperlink{SH__ApplicationCore_8h}{SH\_ApplicationCore.h}"}
00002 \textcolor{preprocessor}{#include <QDebug>}
00003 \textcolor{preprocessor}{#include "\hyperlink{SH__DatabaseManager_8h}{SH\_DatabaseManager.h}"}
00004 \textcolor{preprocessor}{#include "\hyperlink{SH__ServiceCharging_8h}{logic/SH\_ServiceCharging.h}"}
00005 \textcolor{preprocessor}{#include "\hyperlink{SH__BillingCreation_8h}{logic/SH\_BillingCreation.h}"}
00006 
00007 
\hypertarget{SH__ApplicationCore_8cpp_source_l00014}{}\hyperlink{classSH__ApplicationCore_a3c33fe8a39bd571c4c809d8c55603156}{00014} \hyperlink{classSH__ApplicationCore_a3c33fe8a39bd571c4c809d8c55603156}{SH\_ApplicationCore::SH\_ApplicationCore}(
      \hyperlink{classQObject}{QObject}* parent) :
00015     \hyperlink{classQObject}{QObject}(parent)
00016 \{
00017     \hyperlink{classSH__ApplicationCore_ab50397fef5fa4a514e0a1a0443b886ce}{init}();
00018 \}
00019 
\hypertarget{SH__ApplicationCore_8cpp_source_l00025}{}\hyperlink{classSH__ApplicationCore_a210295d4d7a6e16e9def6e0a29816b51}{00025} \hyperlink{classSH__ApplicationCore_a6b93b2f83a290305f282616eb2935899}{SH\_ApplicationCore::AppMode} \hyperlink{classSH__ApplicationCore_a210295d4d7a6e16e9def6e0a29816b51}{SH\_ApplicationCore::mode}()\textcolor{keyword}{
       const}
00026 \textcolor{keyword}{}\{
00027     \textcolor{keywordflow}{return} \hyperlink{classSH__ApplicationCore_ac9587a451ab2294abe7a9eb738d93cb0}{m\_mode};
00028 \}
00029 
\hypertarget{SH__ApplicationCore_8cpp_source_l00035}{}\hyperlink{classSH__ApplicationCore_ab50397fef5fa4a514e0a1a0443b886ce}{00035} \textcolor{keywordtype}{void} \hyperlink{classSH__ApplicationCore_ab50397fef5fa4a514e0a1a0443b886ce}{SH\_ApplicationCore::init}() \{
00036     this->\hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser} = \textcolor{keyword}{new} \hyperlink{classSH__User}{SH\_User}();
00037 \}
00038 
\hypertarget{SH__ApplicationCore_8cpp_source_l00044}{}\hyperlink{classSH__ApplicationCore_aeb87d289ccc9c8209928f23cf8a02ead}{00044} \textcolor{keywordtype}{void} \hyperlink{classSH__ApplicationCore_aeb87d289ccc9c8209928f23cf8a02ead}{SH\_ApplicationCore::setMode}(
      \hyperlink{classSH__ApplicationCore_a6b93b2f83a290305f282616eb2935899}{SH\_ApplicationCore::AppMode} mode)
00045 \{
00046     \textcolor{keywordflow}{if}(!this->\hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser} || ! \hyperlink{classSH__User_aa83a99478cf6c738f995c5c36345bcd3}{SH\_User::exists}(QVariant(this->
      \hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser}->\hyperlink{classSH__User_a18a7ad8ceded0edd3cb93e36cfcd2099}{name}())).toBool()) \{
00047         this->\hyperlink{classSH__ApplicationCore_ac9587a451ab2294abe7a9eb738d93cb0}{m\_mode} = \hyperlink{classSH__ApplicationCore_a6b93b2f83a290305f282616eb2935899a3594de687d70f634e91ef60a63b74172}{CONNEXION};
00048     \} \textcolor{keywordflow}{else} \{
00049         \textcolor{keywordflow}{if}(((mode == \hyperlink{classSH__ApplicationCore_a6b93b2f83a290305f282616eb2935899a110d50af3f0d2f505021620359b6163b}{ADMINISTRATION}) && (!this->\hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser}->
      \hyperlink{classSH__User_ad2acd7b3caca088be8cab00aee11c0e1}{isAdministrator}())) ||
00050                 ((mode == \hyperlink{classSH__ApplicationCore_a6b93b2f83a290305f282616eb2935899ae3d0d6045024cbde467f9c8cb536c6a8}{MANAGEMENT\_X}) && (!this->\hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser}->
      \hyperlink{classSH__User_ac69553a66b8c7177c9a5e28a64f02d48}{isManagerX}())) ||
00051                 ((mode == \hyperlink{classSH__ApplicationCore_a6b93b2f83a290305f282616eb2935899ad68aea91f508ecc6cc9fe1430ddccaf1}{MANAGEMENT\_Z}) && (!this->\hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser}->
      \hyperlink{classSH__User_aa59c59a6f538628c883216e4a73e4c75}{isManagerZ}())) ||
00052                 ((mode == \hyperlink{classSH__ApplicationCore_a6b93b2f83a290305f282616eb2935899a16687d65e8feb3b768ff655d73a45916}{RECEPTION}) && (!this->\hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser}->
      \hyperlink{classSH__User_aa0da8b3326fe98d0ce5ec32e284d8e67}{isReceptionist}()))) \{
00053             this->\hyperlink{classSH__ApplicationCore_ac9587a451ab2294abe7a9eb738d93cb0}{m\_mode} = \hyperlink{classSH__ApplicationCore_a6b93b2f83a290305f282616eb2935899a1892b908076a0887805e80f590ecdef4}{ACCUEIL};
00054         \} \textcolor{keywordflow}{else} \{
00055             this->\hyperlink{classSH__ApplicationCore_ac9587a451ab2294abe7a9eb738d93cb0}{m\_mode} = \hyperlink{classSH__ApplicationCore_a210295d4d7a6e16e9def6e0a29816b51}{mode};
00056         \}
00057     \}
00058 \}
00059 
\hypertarget{SH__ApplicationCore_8cpp_source_l00065}{}\hyperlink{classSH__ApplicationCore_aa154f69097fb07514b300f9c8f189da9}{00065} \hyperlink{classSH__User}{SH\_User} *\hyperlink{classSH__ApplicationCore_aa154f69097fb07514b300f9c8f189da9}{SH\_ApplicationCore::user}()\textcolor{keyword}{ const}
00066 \textcolor{keyword}{}\{
00067     \textcolor{keywordflow}{return} this->\hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser};
00068 \}
00069 
\hypertarget{SH__ApplicationCore_8cpp_source_l00075}{}\hyperlink{classSH__ApplicationCore_abe6683bdada7ecf979b74656748be106}{00075} \textcolor{keywordtype}{bool} \hyperlink{classSH__ApplicationCore_abe6683bdada7ecf979b74656748be106}{SH\_ApplicationCore::userLogOut}()
00076 \{
00077     this->\hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser} = \textcolor{keyword}{new} \hyperlink{classSH__User}{SH\_User}();
00078     \textcolor{keywordflow}{return} !this->\hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser}->\hyperlink{classSH__User_aa1b7fd66632c13905f3b6fd941505c02}{isValid}();
00079 \}
00080 
\hypertarget{SH__ApplicationCore_8cpp_source_l00086}{}\hyperlink{classSH__ApplicationCore_a83d2df40550a95586e70a08833dc5e5f}{00086} \textcolor{keywordtype}{bool} \hyperlink{classSH__ApplicationCore_a83d2df40550a95586e70a08833dc5e5f}{SH\_ApplicationCore::setUser}(QString login, QString pass)
00087 \{
00088     this->\hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser} = \hyperlink{classSH__User_ad83af309786cb1ed5dbbd2cdca195c30}{SH\_User::logIn}(login,pass);
00089     \textcolor{keywordflow}{if}(this->\hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser}->\hyperlink{classSH__User_aa1b7fd66632c13905f3b6fd941505c02}{isValid}()) \{
00090         emit \hyperlink{classSH__ApplicationCore_af0c5c92e7b410b226c3497cec2ddfd97}{userChanged}(QVariant(this->\hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser}->
      \hyperlink{classSH__User_a18a7ad8ceded0edd3cb93e36cfcd2099}{name}()));
00091         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00092     \}
00093     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00094 \}
00095 
00096 
\hypertarget{SH__ApplicationCore_8cpp_source_l00102}{}\hyperlink{classSH__ApplicationCore_acce6b4e70ccc2035072df11acba7065a}{00102} \textcolor{keywordtype}{bool} \hyperlink{classSH__ApplicationCore_acce6b4e70ccc2035072df11acba7065a}{SH\_ApplicationCore::userExists}(QString login)
00103 \{
00104     \textcolor{keywordflow}{return} \hyperlink{classSH__User_aa83a99478cf6c738f995c5c36345bcd3}{SH\_User::exists}(login).toBool();
00105 \}
00106 
00107 
\hypertarget{SH__ApplicationCore_8cpp_source_l00112}{}\hyperlink{classSH__ApplicationCore_aa0cbddb57a9ade990d6ee9b4ee6c3fb3}{00112} \textcolor{keywordtype}{bool} \hyperlink{classSH__ApplicationCore_aa0cbddb57a9ade990d6ee9b4ee6c3fb3}{SH\_ApplicationCore::balanceLogRoutine}() \{
00113     \textcolor{comment}{/*AppDatabase::getInstance()->getDbConnection().exec("execute procedure logPeriodicBalance(H)");}
00114 \textcolor{comment}{    AppDatabase::getInstance()->getDbConnection().exec("execute procedure logPeriodicBalance(D)");}
00115 \textcolor{comment}{    AppDatabase::getInstance()->getDbConnection().exec("execute procedure logPeriodicBalance(W)");}
00116 \textcolor{comment}{    AppDatabase::getInstance()->getDbConnection().exec("execute procedure logPeriodicBalance(M)");}
00117 \textcolor{comment}{    AppDatabase::getInstance()->getDbConnection().exec("execute procedure logPeriodicBalance(Y)");*/}
00118 \}
00119 
00120 
\hypertarget{SH__ApplicationCore_8cpp_source_l00125}{}\hyperlink{classSH__ApplicationCore_ae53ffaee0269f03c3c938595b9b4b39f}{00125} \textcolor{keywordtype}{void} \hyperlink{classSH__ApplicationCore_ae53ffaee0269f03c3c938595b9b4b39f}{SH\_ApplicationCore::receiveInput}(QString in)
00126 \{
00127     qDebug() << \textcolor{stringliteral}{"input received "}<<in;
00128     emit this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->\hyperlink{classSH__InOutStateMachine_ab224e4a6ab99c15770bc63e1b8fdb771}{receiveInput}(in);
00129 
00130 \}
00131 
\hypertarget{SH__ApplicationCore_8cpp_source_l00136}{}\hyperlink{classSH__ApplicationCore_af450727db378ebec9ec61457b2e13664}{00136} \textcolor{keywordtype}{void} \hyperlink{classSH__ApplicationCore_af450727db378ebec9ec61457b2e13664}{SH\_ApplicationCore::receiveValidation}()
00137 \{
00138 
00139     emit this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->\hyperlink{classSH__InOutStateMachine_a5a5804bd32a04d25926f6e323b906887}{validateInput}();
00140 
00141 \}
00142 
\hypertarget{SH__ApplicationCore_8cpp_source_l00147}{}\hyperlink{classSH__ApplicationCore_a942eacab69b9fe54442591c07773c908}{00147} \textcolor{keywordtype}{void} \hyperlink{classSH__ApplicationCore_a942eacab69b9fe54442591c07773c908}{SH\_ApplicationCore::receiveConfirmation}()
00148 \{
00149 
00150     emit this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->\hyperlink{classSH__InOutStateMachine_a0fb4c4d63ccb19df48f1e060d02d8ae3}{confirmInput}();
00151 
00152 \}
00153 
\hypertarget{SH__ApplicationCore_8cpp_source_l00158}{}\hyperlink{classSH__ApplicationCore_ae8bcd097ea219fc9a54f7d0d9ff9c335}{00158} \textcolor{keywordtype}{void} \hyperlink{classSH__ApplicationCore_ae8bcd097ea219fc9a54f7d0d9ff9c335}{SH\_ApplicationCore::replaceInput}(QString inputName)
00159 \{
00160 
00161     emit this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->\hyperlink{classSH__InOutStateMachine_af5f82970faef3bca48a147863dba2ee1}{replaceInput}(inputName);
00162 
00163 \}
00164 
\hypertarget{SH__ApplicationCore_8cpp_source_l00169}{}\hyperlink{classSH__ApplicationCore_a5b788738972737e1d9b52daeb41e8788}{00169} \textcolor{keywordtype}{void} \hyperlink{classSH__ApplicationCore_a5b788738972737e1d9b52daeb41e8788}{SH\_ApplicationCore::cancelReplacement}()
00170 \{
00171     \textcolor{keywordflow}{if}(this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}) \{
00172         emit this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->\hyperlink{classSH__InOutStateMachine_a67ce246a765ad91fef76f70ece12213f}{cancelReplacement}();
00173     \}
00174 \}
00175 
00176 
\hypertarget{SH__ApplicationCore_8cpp_source_l00182}{}\hyperlink{classSH__ApplicationCore_a30738281acefd721fe9d06db46dcf123}{00182} \textcolor{keywordtype}{bool} \hyperlink{classSH__ApplicationCore_a30738281acefd721fe9d06db46dcf123}{SH\_ApplicationCore::launchBillingsThread}()
00183 \{
00184     qDebug() << \textcolor{stringliteral}{"Hallo !"};
00185     \textcolor{comment}{/*if(this->m\_currentFSM) \{}
00186 \textcolor{comment}{        return false;}
00187 \textcolor{comment}{    \}*/}
00188     qDebug() << \textcolor{stringliteral}{"Hallo !"};
00189     this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}= \textcolor{keyword}{new} \hyperlink{classSH__BillingCreationStateMachine}{SH\_BillingCreationStateMachine}(\textcolor{stringliteral}{"
      création facturation"});
00190     this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->start();
00191     qDebug() << this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->\hyperlink{classSH__InOutStateMachine_a60ecd7de03d948e2d1e9cbedb5c3e5fa}{toString}() << \textcolor{stringliteral}{" "} << this->
      \hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->initialState();
00192     \textcolor{keywordflow}{return} this->\hyperlink{classSH__ApplicationCore_a3a10c2d662707140340d7a827d119c8d}{connectRunningThread}();
00193 
00194 \}
00195 
\hypertarget{SH__ApplicationCore_8cpp_source_l00201}{}\hyperlink{classSH__ApplicationCore_a193a9132da92b5e7a450e9307b657893}{00201} \textcolor{keywordtype}{bool} \hyperlink{classSH__ApplicationCore_a193a9132da92b5e7a450e9307b657893}{SH\_ApplicationCore::launchBookingsThread}()
00202 \{
00203     \textcolor{comment}{/*if(this->m\_currentFSM) \{}
00204 \textcolor{comment}{        return false;}
00205 \textcolor{comment}{    \}*/}
00206     \textcolor{comment}{/*this->m\_currentFSM= new BookingCreationStateMachine("création facturation");*/}
00207     \textcolor{comment}{/*this->m\_currentFSM->start();*/}
00208     \textcolor{keywordflow}{return} this->\hyperlink{classSH__ApplicationCore_a3a10c2d662707140340d7a827d119c8d}{connectRunningThread}();
00209 \}
00210 
\hypertarget{SH__ApplicationCore_8cpp_source_l00216}{}\hyperlink{classSH__ApplicationCore_a17a048025bc51a96663029e58c722741}{00216} \textcolor{keywordtype}{bool} \hyperlink{classSH__ApplicationCore_a17a048025bc51a96663029e58c722741}{SH\_ApplicationCore::launchBillThread}()
00217 \{
00218     \textcolor{comment}{/*if(this->m\_currentFSM) \{}
00219 \textcolor{comment}{        return false;}
00220 \textcolor{comment}{    \}*/}
00221     this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}= \textcolor{keyword}{new} \hyperlink{classSH__ServiceCharging}{SH\_ServiceCharging}(\textcolor{stringliteral}{"facturation prestation"});
00222     this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->\hyperlink{classSH__InOutStateMachine_aa2766b7a7ba39c35a10df7fc0c151b4f}{setContentValue}(QVariant(this->
      \hyperlink{classSH__ApplicationCore_aa61720acee7e06e9828c570e8190304a}{m\_currentUser}->\hyperlink{classSH__User_ad6fb57220df359c4cd28fbd8fcc71b12}{id}()), \textcolor{stringliteral}{"BILL\_ID"});
00223     this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->start();
00224     \textcolor{keywordflow}{return} this->\hyperlink{classSH__ApplicationCore_a3a10c2d662707140340d7a827d119c8d}{connectRunningThread}();
00225 \}
00226 
\hypertarget{SH__ApplicationCore_8cpp_source_l00232}{}\hyperlink{classSH__ApplicationCore_af50ebbfed4c12ad7d69cc78f4b0d0d85}{00232} \textcolor{keywordtype}{bool} \hyperlink{classSH__ApplicationCore_af50ebbfed4c12ad7d69cc78f4b0d0d85}{SH\_ApplicationCore::cancelRunningThread}()
00233 \{
00234     \textcolor{comment}{/*if(!this->m\_currentFSM) \{}
00235 \textcolor{comment}{        return true;}
00236 \textcolor{comment}{    \}*/}
00237     this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->stop();
00238     \textcolor{keywordtype}{bool} ok = !this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->isRunning();
00239     this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM} = NULL;
00240     \textcolor{keywordflow}{return} ok;
00241 \}
00242 
00243 
\hypertarget{SH__ApplicationCore_8cpp_source_l00249}{}\hyperlink{classSH__ApplicationCore_a3a10c2d662707140340d7a827d119c8d}{00249} \textcolor{keywordtype}{bool} \hyperlink{classSH__ApplicationCore_a3a10c2d662707140340d7a827d119c8d}{SH\_ApplicationCore::connectRunningThread}()
00250 \{
00251     \textcolor{comment}{/*if(!this->m\_currentFSM) \{}
00252 \textcolor{comment}{        return false;}
00253 \textcolor{comment}{    \}*/}
00254     qDebug() << \textcolor{stringliteral}{"coucou"};
00255     QObject::connect(this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}, &
      \hyperlink{classSH__InOutStateMachine_ae2cbbe3cd207158668dcb4838938c7ad}{SH\_InOutStateMachine::sendText}, \textcolor{keyword}{this}, &
      \hyperlink{classSH__ApplicationCore_ac70121669e6133e84b0b8266b09b9199}{SH\_ApplicationCore::sendText}, Qt::DirectConnection);
00256         QObject::connect(this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}, &
      \hyperlink{classSH__InOutStateMachine_ad722deb53285919796b04db5af6e51b4}{SH\_InOutStateMachine::clearAll}, \textcolor{keyword}{this}, &
      \hyperlink{classSH__ApplicationCore_a5f60ca485028cf56d9d56f7e80685f10}{SH\_ApplicationCore::clearAll}, Qt::DirectConnection);
00257         QObject::connect(this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}, &
      \hyperlink{classSH__InOutStateMachine_a526822c66b46aa0cd81ba4473fa5573f}{SH\_InOutStateMachine::resendText}, \textcolor{keyword}{this}, &
      \hyperlink{classSH__ApplicationCore_a5eb6c04758ff47330a8249da2b3265f2}{SH\_ApplicationCore::resendText}, Qt::DirectConnection);
00258     QObject::connect(this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}, &
      \hyperlink{classSH__InOutStateMachine_a0d241868828cbf9798233a8c74c69851}{SH\_InOutStateMachine::displayCalendar}, \textcolor{keyword}{this}, &
      \hyperlink{classSH__ApplicationCore_a7236456c901a089ca6e5735ec7e5da03}{SH\_ApplicationCore::displayCalendar}, Qt::DirectConnection);
00259     \textcolor{keywordflow}{return} this->\hyperlink{classSH__ApplicationCore_a1088f3ba13abb8b3989cc0c325524232}{m\_currentFSM}->isRunning();
00260 \}
\end{DoxyCode}
