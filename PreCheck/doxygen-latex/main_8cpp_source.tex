\hypertarget{main_8cpp}{\section{main.\-cpp}
\label{main_8cpp}\index{/home/tiff/\-Stage-\/\-I\-U\-T/app/simplhotel/hotel-\/precheck/src/\-Pre\-Check/main.\-cpp@{/home/tiff/\-Stage-\/\-I\-U\-T/app/simplhotel/hotel-\/precheck/src/\-Pre\-Check/main.\-cpp}}
}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include <QtWidgets/QApplication>}
00002 \textcolor{preprocessor}{#include <QtQml>}
00003 \textcolor{preprocessor}{#include <QtQuick>}
00004 \textcolor{preprocessor}{#include <QProgressDialog>}
00005 \textcolor{preprocessor}{#include "\hyperlink{SH__MessageManager_8h}{SH\_MessageManager.h}"}
00006 \textcolor{preprocessor}{#include "\hyperlink{SH__ApplicationCore_8h}{SH\_ApplicationCore.h}"}
00007 \textcolor{preprocessor}{#include "\hyperlink{SH__ExtendedSqlProxyModel_8h}{models/SH\_ExtendedSqlProxyModel.h}"}
00008 \textcolor{preprocessor}{#include "\hyperlink{SH__RoomsTableModel_8h}{models/SH\_RoomsTableModel.h}"}
00009 \textcolor{preprocessor}{#include "\hyperlink{SH__VATTableModel_8h}{models/SH\_VATTableModel.h}"}
00010 \textcolor{preprocessor}{#include "\hyperlink{SH__SqlDataField_8h}{models/SH\_SqlDataField.h}"}
00011 \textcolor{preprocessor}{#include "\hyperlink{SH__BillingsTableModel_8h}{models/SH\_BillingsTableModel.h}"}
00012 \textcolor{preprocessor}{#include "\hyperlink{SH__BillsTableModel_8h}{models/SH\_BillsTableModel.h}"}
00013 \textcolor{preprocessor}{#include "\hyperlink{SH__BookingsTableModel_8h}{models/SH\_BookingsTableModel.h}"}
00014 \textcolor{preprocessor}{#include "\hyperlink{SH__RoomsTableModel_8h}{models/SH\_RoomsTableModel.h}"}
00015 \textcolor{preprocessor}{#include "\hyperlink{SH__ClientsTableModel_8h}{models/SH\_ClientsTableModel.h}"}
00016 \textcolor{preprocessor}{#include "\hyperlink{SH__ServicesTableModel_8h}{models/SH\_ServicesTableModel.h}"}
00017 \textcolor{preprocessor}{#include "\hyperlink{SH__GroupsTableModel_8h}{models/SH\_GroupsTableModel.h}"}
00018 \textcolor{preprocessor}{#include "\hyperlink{SH__User_8h}{models/SH\_User.h}"}
00019 \textcolor{preprocessor}{#include "\hyperlink{SH__UsersTableModel_8h}{models/SH\_UsersTableModel.h}"}
00020 \textcolor{preprocessor}{#include "\hyperlink{SH__TraineesTableModel_8h}{models/SH\_TraineesTableModel.h}"}
00021 \textcolor{preprocessor}{#include "\hyperlink{SH__ExtendedQQmlAction_8h}{views/SH\_ExtendedQQmlAction.h}"}
00022 \textcolor{preprocessor}{#include "../../libs/QsLog\_2.0.b1/QsLog.h"}
00023 \textcolor{preprocessor}{#include "../../libs/QsLog\_2.0.b1/QsLogDest.h"}
00024 
00025 
00026 \textcolor{keyword}{using namespace }std;
00027 \textcolor{comment}{//using namespace SimplHotel;}
00028 
\hypertarget{main_8cpp_source_l00029}{}\hyperlink{main_8cpp_aab83ac6564fd72e82c62b21733ca0e1b}{00029} \textcolor{keyword}{const} \textcolor{keywordtype}{int} \hyperlink{main_8cpp_aab83ac6564fd72e82c62b21733ca0e1b}{iterations} = 20;
00030 
\hypertarget{main_8cpp_source_l00036}{}\hyperlink{main_8cpp_aaf7c4666a49fc2890c12b6ae393b8deb}{00036} \textcolor{keywordtype}{void} \hyperlink{main_8cpp_aaf7c4666a49fc2890c12b6ae393b8deb}{statusChanged}(QQmlComponent* component, QQmlComponent::Status status) \{
00037     \textcolor{keywordflow}{if} (status == QQmlComponent::Error) \{
00038         \textcolor{keywordflow}{foreach} (\textcolor{keyword}{const} QQmlError &error, component->errors()) \{
00039             \textcolor{keyword}{const} QByteArray file = error.url().toEncoded();
00040             QMessageLogger(file.constData(), error.line(), 0).debug() << error.description();
00041         \}
00042     \}
00043 \}
00044 
\hypertarget{main_8cpp_source_l00051}{}\hyperlink{main_8cpp_a5e94203dceafb66df570cbbc79cb52bc}{00051} \textcolor{keywordtype}{void} \hyperlink{main_8cpp_a5e94203dceafb66df570cbbc79cb52bc}{exportlog}(QtMsgType type, \textcolor{keyword}{const} QMessageLogContext &context, \textcolor{keyword}{const} QString &msg) \{
00052     Q\_UNUSED(context);
00053     QFile file(QApplication::applicationDirPath()+\textcolor{stringliteral}{"/"}+qAppName()+\textcolor{stringliteral}{".log"});
00054     file.open(QIODevice::WriteOnly | QIODevice::Append);
00055     file.write(QString(\textcolor{stringliteral}{"["}).toUtf8()+QDateTime::currentDateTime().toString().toUtf8()+QString(\textcolor{stringliteral}{"] "}).toUtf8(
      ));
00056     QString typeName;
00057     \textcolor{keywordflow}{switch} (type) \{
00058     \textcolor{keywordflow}{case} QtDebugMsg:
00059         typeName = QObject::tr(\textcolor{stringliteral}{"Debug"});
00060         \textcolor{keywordflow}{break};
00061     \textcolor{keywordflow}{case} QtWarningMsg:
00062         typeName = QObject::tr(\textcolor{stringliteral}{"Warning"});
00063         \textcolor{keywordflow}{break};
00064     \textcolor{keywordflow}{case} QtFatalMsg:
00065     \textcolor{keywordflow}{case} QtCriticalMsg:
00066         \textcolor{keywordflow}{break};
00067     \}
00068     file.write(QObject::tr(\textcolor{stringliteral}{"%1: %2\(\backslash\)r\(\backslash\)n"}).arg(typeName).arg(msg).toUtf8());
00069 \}
00070 
00071 
\hypertarget{main_8cpp_source_l00080}{}\hyperlink{main_8cpp_ac3c79e35c4fc5c50939ae90485e1483f}{00080} \textcolor{keywordtype}{void} \hyperlink{main_8cpp_ac3c79e35c4fc5c50939ae90485e1483f}{enableLogging}(\textcolor{keyword}{const} QString sLogPath)
00081 \{
00082 
00083     \textcolor{comment}{/* init the logging mechanism*/}
00084     QsLogging::Logger& logger = QsLogging::Logger::instance();
00085     logger.setLoggingLevel(QsLogging::TraceLevel);
00086 
00087     QsLogging::DestinationPtr fileDestination(
00088                 QsLogging::DestinationFactory::MakeFileDestination(sLogPath, \textcolor{keyword}{true}, 512, 2) );
00089     QsLogging::DestinationPtr debugDestination(
00090                 QsLogging::DestinationFactory::MakeDebugOutputDestination() );
00091     logger.addDestination(debugDestination);
00092     logger.addDestination(fileDestination);
00093 
00094     logger.setLoggingLevel(QsLogging::OffLevel);
00095     \textcolor{comment}{/*turning logging off*/}
00096 
00097 
00098 
00099     \textcolor{comment}{/*qInstallMessageHandler(exportlog);*/}
00100 
00101 
00102     \textcolor{comment}{/* QLOG\_INFO() << "Here is some information";}
00103 \textcolor{comment}{}
00104 \textcolor{comment}{    QLOG\_TRACE() << "Here's a" << QString::fromUtf8("trace") << "message";}
00105 \textcolor{comment}{    QLOG\_DEBUG() << "Here's a" << static\_cast<int>(QsLogging::DebugLevel) << "message";}
00106 \textcolor{comment}{    QLOG\_WARN() << "Uh-oh!";}
00107 \textcolor{comment}{    qDebug() << "This message won't be picked up by the logger";}
00108 \textcolor{comment}{    QLOG\_ERROR() << "An example error has occurred";}
00109 \textcolor{comment}{    qWarning() << "Neither will this one";}
00110 \textcolor{comment}{    QLOG\_FATAL() << "Fatal error example!";*/}
00111 \}
00112 
00113 
00114 
00115 
\hypertarget{main_8cpp_source_l00121}{}\hyperlink{main_8cpp_ae410a0b90b40ede93034f3ec13d27b8e}{00121} \textcolor{keywordtype}{void} \hyperlink{main_8cpp_ae410a0b90b40ede93034f3ec13d27b8e}{spin}(\textcolor{keywordtype}{int} &iteration)
00122 \{
00123     \textcolor{keyword}{const} \textcolor{keywordtype}{int} work = 1000 * 1000 * 40;
00124     \textcolor{keyword}{volatile} \textcolor{keywordtype}{int} v = 0;
00125     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < work; ++j)
00126         ++v;
00127 
00128     qDebug() << \textcolor{stringliteral}{"iteration"} << iteration << \textcolor{stringliteral}{"in thread"} << QThread::currentThreadId();
00129 \}
00130 
\hypertarget{main_8cpp_source_l00131}{}\hyperlink{main_8cpp_ab2eb0cb44a3cc4d8aab3ba47699b5090}{00131} \textcolor{keywordtype}{void} \hyperlink{main_8cpp_ab2eb0cb44a3cc4d8aab3ba47699b5090}{initSettings}(QSettings::Scope scope, QString devName,QString appName) \{
00132     QSettings settings(scope, devName, appName);
00133     settings.beginGroup(\textcolor{stringliteral}{"global GUI"});
00134     settings.setValue(\textcolor{stringliteral}{"backgroundColor"},\textcolor{stringliteral}{"whitesmoke"});
00135     \textcolor{comment}{//TODO: continuer avec toutes les valeurs configurables pour le premier lancement (installation)}
00136     settings.endGroup();
00137 \}
00138 
\hypertarget{main_8cpp_source_l00146}{}\hyperlink{main_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{00146} \textcolor{keywordtype}{int} \hyperlink{main_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{main}(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv)
00147 \{
00148     \textcolor{keywordflow}{try}
00149     \{
00150         qDebug();
00151         \textcolor{comment}{/* Un simple retour Ã  la ligne pour un affichage propre dans la console*/}
00152 
00153         QApplication app(argc, argv);
00154 
00155         \textcolor{keyword}{const} QString sLogPath(QDir::cleanPath(app.applicationDirPath()+\textcolor{stringliteral}{"
      /../../../src/PreCheck/debugLog.txt"}));
00156         \hyperlink{main_8cpp_ac3c79e35c4fc5c50939ae90485e1483f}{enableLogging}(sLogPath);
00157 
00158         QString appName = QString(QObject::tr(\textcolor{stringliteral}{"PreCheck"}));
00159         QString devName = QString(\textcolor{stringliteral}{"SimplHotel"});
00160         QCoreApplication::setOrganizationName(devName);
00161         QCoreApplication::setApplicationName(appName);
00162 
00163 \hyperlink{main_8cpp_ab2eb0cb44a3cc4d8aab3ba47699b5090}{initSettings}(QSettings::SystemScope, devName,appName);
00164 
00165         QString locale = QLocale::system().name();
00166         QTranslator translator;
00167         \textcolor{keywordflow}{if} (!QFile::exists(appName.toLower() + \textcolor{stringliteral}{"\_"} + locale + \textcolor{stringliteral}{".qm"}))
00168         \{
00169             locale = locale.section(\textcolor{charliteral}{'\_'}, 0, 0);
00170         \}
00171         \textcolor{keywordflow}{if} (QFile::exists(appName.toLower() + \textcolor{stringliteral}{"\_"} + locale + \textcolor{stringliteral}{".qm"}))
00172         \{
00173             translator.load(appName.toLower() + \textcolor{stringliteral}{"\_"} + locale);
00174             app.installTranslator(&translator);
00175         \}
00176 
00177         QQmlEngine engine;
00178 
00179 
00180         \textcolor{comment}{/*qmlRegisterUncreatableType<SimplHotel::SH\_ApplicationCore>("PreCheck", 1, 0, "AppMode","pour enum
       AppMode");}
00181 \textcolor{comment}{        qmlRegisterType<SimplHotel::SH\_User>("PreCheck", 1, 0, "User");}
00182 \textcolor{comment}{        SimplHotel::SH\_ApplicationCore* appManager = new SimplHotel::SH\_ApplicationCore();*/}
00183         qmlRegisterUncreatableType<SH\_ApplicationCore>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"AppMode"},\textcolor{stringliteral}{"pour enum AppMode"});
00184         qmlRegisterType<SH\_User>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"User"});
00185 
00186 
00187         \hyperlink{classSH__ApplicationCore}{SH\_ApplicationCore}* appManager = \textcolor{keyword}{new} 
      \hyperlink{classSH__ApplicationCore}{SH\_ApplicationCore}();
00188         appManager->setSettings(QSettings::SystemScope, devName,appName); \textcolor{comment}{// system-wide location for the
       application}
00189         engine.rootContext()->setContextProperty(\textcolor{stringliteral}{"App"}, appManager);
00190 
00191 
00192         qmlRegisterType<SH\_VATTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_VATModel"});
00193         qmlRegisterType<SH\_UsersTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_UsersListModel"});
00194         qmlRegisterType<SH\_TraineesTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_TraineesListModel"});
00195 
00196         \textcolor{comment}{/*qmlRegisterType<SimplHotel::SH\_RoomsTableModel>("PreCheck", 1, 0, "SH\_RoomsModel");}
00197 \textcolor{comment}{        qmlRegisterType<SimplHotel::SH\_BillingsTableModel>("PreCheck", 1, 0, "SH\_BillingsModel");}
00198 \textcolor{comment}{        qmlRegisterType<SimplHotel::SH\_BillsTableModel>("PreCheck", 1, 0, "SH\_BillsModel");}
00199 \textcolor{comment}{        qmlRegisterType<SimplHotel::SH\_BookingsTableModel>("PreCheck", 1, 0, "SH\_BookingsModel");}
00200 \textcolor{comment}{        qmlRegisterType<SimplHotel::SH\_ServicesTableModel>("PreCheck", 1, 0, "SH\_ServicesModel");}
00201 \textcolor{comment}{        qmlRegisterType<SimplHotel::SH\_ClientsTableModel>("PreCheck", 1, 0, "SH\_ClientsModel");}
00202 \textcolor{comment}{        qmlRegisterType<SimplHotel::SH\_GroupsTableModel>("PreCheck", 1, 0, "SH\_GroupsModel");}
00203 \textcolor{comment}{        qmlRegisterType<SimplHotel::SH\_SqlDataFields>("PreCheck", 1, 0, "SH\_SqlDataField");}
00204 \textcolor{comment}{        qmlRegisterType<SimplHotel::SH\_ExtendedQQmlAction>("PreCheck", 1, 0, "SH\_ComplexAction");*/}
00205         qmlRegisterType<SH\_RoomsTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_RoomsModel"});
00206         qmlRegisterType<SH\_BillingsTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_BillingsModel"});
00207         qmlRegisterType<SH\_BillsTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_BillsModel"});
00208         qmlRegisterType<SH\_BookingsTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_BookingsModel"});
00209         qmlRegisterType<SH\_ServicesTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_ServicesModel"});
00210         qmlRegisterType<SH\_ClientsTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_ClientsModel"});
00211         qmlRegisterType<SH\_GroupsTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_GroupsModel"});
00212         qmlRegisterType<SH\_SqlDataFields>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_SqlDataField"});
00213         qmlRegisterType<SH\_ExtendedQQmlAction>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_ComplexAction"});
00214 
00215         QQmlComponent component(&engine);
00216         component.loadUrl(QUrl(\textcolor{stringliteral}{"qrc:/qml/SH\_app.qml"}));
00217         \textcolor{keywordflow}{if} (!component.isReady())
00218         \{
00219             qWarning(\textcolor{stringliteral}{"%s"}, qPrintable(component.errorString()));
00220             \textcolor{keywordflow}{return} -1;
00221         \}
00222         \hyperlink{classQObject}{QObject} *topLevel = component.create();
00223         QQuickWindow *window = qobject\_cast<QQuickWindow *>(topLevel);
00224         \textcolor{keywordflow}{if} (!window)
00225         \{
00226             qWarning(\textcolor{stringliteral}{"Error: Your root item has to be a Window."});
00227             \textcolor{keywordflow}{return} -1;
00228         \}
00229 
00230         \textcolor{comment}{//window->setColor(appManager->readSetting("backgroundColor","global GUI").value<QColor>());}
00231 
00232         \hyperlink{classQObject}{QObject} * commonPage = window->findChild<\hyperlink{classQObject}{QObject} *>(\textcolor{stringliteral}{"Common"});
00233         \hyperlink{classQObject}{QObject} * tabsZone = commonPage->findChild<\hyperlink{classQObject}{QObject} *>(\textcolor{stringliteral}{"TabView"});
00234         \hyperlink{classQObject}{QObject} * displayZone = commonPage->findChild<\hyperlink{classQObject}{QObject} *>(\textcolor{stringliteral}{"RightOutput"});
00235 
00236         QObject::connect(appManager, SIGNAL(openTab(QVariant)), tabsZone, SLOT(openTab(QVariant)), 
      Qt::DirectConnection);
00237         QObject::connect(appManager, SIGNAL(sendText(QString, \textcolor{keywordtype}{bool})), displayZone, SIGNAL(displayNew(
      QString, \textcolor{keywordtype}{bool})), Qt::DirectConnection);
00238         QObject::connect(appManager, SIGNAL(resendText(QString)), displayZone, SIGNAL(replace(QString)), 
      Qt::DirectConnection);
00239         QObject::connect(appManager, SIGNAL(clearAll()), displayZone, SLOT(clearAll()), 
      Qt::QueuedConnection);
00240         QObject::connect(appManager, SIGNAL(displayFileDialog()), commonPage, SLOT(displayFileDialog()), 
      Qt::DirectConnection);
00241         QObject::connect(appManager, SIGNAL(displayChoiceList(QVariant)), displayZone, SIGNAL(
      displaySqlDatas(QVariant)), Qt::DirectConnection);
00242         \textcolor{comment}{/*QObject::connect(appManager, SIGNAL(displayCalendar()), displayZone, SLOT(displayCalendar()),
       Qt::DirectConnection);*/}
00243 
00244         QObject::connect(&engine, SIGNAL(quit()), &app, SLOT(quit()));
00245 
00246 
00247         QLOG\_INFO() << \textcolor{stringliteral}{"Program built with Qt"} << QT\_VERSION\_STR << \textcolor{stringliteral}{"running on"} << qVersion();
00248         window->show();
00249         \textcolor{keywordflow}{return} app.exec();
00250 
00251     \}
00252     \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} std::exception &e)
00253     \{
00254 
00255         \textcolor{comment}{/*SimplHotel::SH\_MessageManager::errorMessage(e.what());*/}
00256         \hyperlink{classSH__MessageManager_a0cb4f06cf67539457482ba1c8544eb06}{SH\_MessageManager::errorMessage}(e.what());
00257     \}
00258 \}
\end{DoxyCode}
