\hypertarget{SH__BillingCreation__0_8cpp}{\section{S\-H\-\_\-\-Billing\-Creation\-\_\-0.\-cpp}
\label{SH__BillingCreation__0_8cpp}\index{/home/tiff/\-Stage-\/\-I\-U\-T/app/simplhotel/hotel-\/precheck/src/\-Pre\-Check/logic/\-S\-H\-\_\-\-Billing\-Creation\-\_\-0.\-cpp@{/home/tiff/\-Stage-\/\-I\-U\-T/app/simplhotel/hotel-\/precheck/src/\-Pre\-Check/logic/\-S\-H\-\_\-\-Billing\-Creation\-\_\-0.\-cpp}}
}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "\hyperlink{SH__BillingCreation_8h}{SH\_BillingCreation.h}"}
00002 \textcolor{preprocessor}{#include "\hyperlink{SH__StatementState_8h}{SH\_StatementState.h}"}
00003 \textcolor{preprocessor}{#include "\hyperlink{SH__NumericQuestionState_8h}{SH\_NumericQuestionState.h}"}
00004 \textcolor{preprocessor}{#include "\hyperlink{SH__DateQuestionState_8h}{SH\_DateQuestionState.h}"}
00005 \textcolor{preprocessor}{#include "\hyperlink{SH__DatabaseContentQuestionState_8h}{SH\_DatabaseContentQuestionState.h}"}
00006 \textcolor{preprocessor}{#include "\hyperlink{SH__ConfirmationState_8h}{SH\_ConfirmationState.h}"}
00007 \textcolor{preprocessor}{#include "\hyperlink{SH__LoopingIOStateMachine_8h}{SH\_LoopingIOStateMachine.h}"}
00008 \textcolor{preprocessor}{#include "\hyperlink{SH__AdaptDatabaseState_8h}{SH\_AdaptDatabaseState.h}"}
00009 \textcolor{preprocessor}{#include "\hyperlink{SH__ClientCreation_8h}{SH\_ClientCreation.h}"}
00010 
00011 \hyperlink{classSH__BillingCreationStateMachine_ad62b77fa4aeafe200056ff3974562f83}{SH\_BillingCreationStateMachine::SH\_BillingCreationStateMachine}
      (QString name, \hyperlink{classQObject}{QObject} *parent) :
00012     \hyperlink{classSH__InOutStateMachine}{SH\_InOutStateMachine}(\textcolor{stringliteral}{"BILLINGS"},name, parent)
00013 \{
00014     qDebug() << \textcolor{stringliteral}{"facturation"};
00015 
00016     \hyperlink{classSH__StatementState}{SH\_StatementState}* intro = \textcolor{keyword}{new} \hyperlink{classSH__StatementState}{SH\_StatementState}(\textcolor{stringliteral}{"Création d'une
       facturation"}, \textcolor{stringliteral}{"intro billing creation"});
00017     \hyperlink{classSH__NumericQuestionState}{SH\_NumericQuestionState}* nbAdults = \textcolor{keyword}{new} 
      \hyperlink{classSH__NumericQuestionState}{SH\_NumericQuestionState}(\textcolor{stringliteral}{"Veuillez entrer le nombre d'adultes"},\textcolor{stringliteral}{"adults billing
       creation"}, 0);
00018     \hyperlink{classSH__NumericQuestionState}{SH\_NumericQuestionState}* nbChildren = \textcolor{keyword}{new} 
      \hyperlink{classSH__NumericQuestionState}{SH\_NumericQuestionState}(\textcolor{stringliteral}{"Veuillez entrer le nombre d'enfants"}, \textcolor{stringliteral}{"children billing
       creation"}, 0);
00019     \hyperlink{classSH__DateQuestionState}{SH\_DateQuestionState}* arrivingDate = \textcolor{keyword}{new} 
      \hyperlink{classSH__DateQuestionState}{SH\_DateQuestionState}(\textcolor{stringliteral}{"Veuillez entrer la date d'arrivée"}, \textcolor{stringliteral}{"arriving date billing
       creation"}, \textcolor{keyword}{true},\textcolor{keyword}{true});
00020     \hyperlink{classSH__DateQuestionState}{SH\_DateQuestionState}* departureDate = \textcolor{keyword}{new} 
      \hyperlink{classSH__DateQuestionState}{SH\_DateQuestionState}(\textcolor{stringliteral}{"Veuillez entrer la date de départ prévue"}, \textcolor{stringliteral}{"departure date
       billing creation"}, \textcolor{keyword}{false},\textcolor{keyword}{true});
00021     \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}* client = \textcolor{keyword}{new} 
      \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}(\textcolor{stringliteral}{"Veuillez entrer le nom du client à facturer
      "},\textcolor{stringliteral}{"main client billing creation"}, \textcolor{stringliteral}{"CLIENTS"}, \textcolor{stringliteral}{"NAME"});
00022     \hyperlink{classSH__ClientCreationStateMachine}{SH\_ClientCreationStateMachine}* clientCreation = \textcolor{keyword}{new} 
      \hyperlink{classSH__ClientCreationStateMachine}{SH\_ClientCreationStateMachine}(\textcolor{stringliteral}{"main client creation in billing creation"});
00023     \hyperlink{classSH__NumericQuestionState}{SH\_NumericQuestionState}* nbRooms = \textcolor{keyword}{new} 
      \hyperlink{classSH__NumericQuestionState}{SH\_NumericQuestionState}(\textcolor{stringliteral}{"Veuillez entrer le nombre de chambres"}, \textcolor{stringliteral}{"nb rooms billing
       creation"}, 1);
00024     \textcolor{comment}{//DatabaseContentQuestionState* type = new DatabaseContentQuestionState("Veuillez choisir le type de
       facturation","billing type billing creation", "BILLINGSTYPES", "CODE");}
00025         \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}* type = \textcolor{keyword}{new} 
      \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}(\textcolor{stringliteral}{"Veuillez choisir le type de facturation"},\textcolor{stringliteral}{"
      billing type billing creation"}, \textcolor{stringliteral}{"BILLINGSTYPES"}, \textcolor{stringliteral}{"ID"});
00026     \hyperlink{classSH__LoopingInOutStateMachine}{SH\_LoopingInOutStateMachine}* roomsAffectation = \textcolor{keyword}{new} 
      \hyperlink{classSH__LoopingInOutStateMachine}{SH\_LoopingInOutStateMachine}(\textcolor{stringliteral}{"ROOMSOCCUPATION"}, \textcolor{stringliteral}{"rooms affectation billing
       creation"});
00027     \hyperlink{classSH__LoopingInOutStateMachine}{SH\_LoopingInOutStateMachine}* billsCreation = \textcolor{keyword}{new} 
      \hyperlink{classSH__LoopingInOutStateMachine}{SH\_LoopingInOutStateMachine}(\textcolor{stringliteral}{"BILLS"}, \textcolor{stringliteral}{"bills creation billing creation"});
00028     \hyperlink{classSH__LoopingInOutStateMachine}{SH\_LoopingInOutStateMachine}* clientList = \textcolor{keyword}{new} 
      \hyperlink{classSH__LoopingInOutStateMachine}{SH\_LoopingInOutStateMachine}(\textcolor{stringliteral}{"CLIENTS"}, \textcolor{stringliteral}{"bills creation billing creation"});
00029     \hyperlink{classSH__ConfirmationState}{SH\_ConfirmationState}* confirmPart1 = \textcolor{keyword}{new} 
      \hyperlink{classSH__ConfirmationState}{SH\_ConfirmationState}(\textcolor{stringliteral}{"Veuillez appuyer sur la touche \(\backslash\)"CONFIRMER\(\backslash\)" pour passer à
       l'étape suivante"}, \textcolor{stringliteral}{"confirm part 1"});
00030     \hyperlink{classSH__AdaptDatabaseState}{SH\_AdaptDatabaseState}* saveState = \textcolor{keyword}{new} 
      \hyperlink{classSH__AdaptDatabaseState}{SH\_AdaptDatabaseState}(\textcolor{stringliteral}{"enregistrement de la machine "}+
      \hyperlink{classSH__GenericStateMachine_a85c0c1c9d258ae991f84667412fa47cd}{toString}());
00031     \hyperlink{classSH__ConfirmationState}{SH\_ConfirmationState}* confirmAll = \textcolor{keyword}{new} 
      \hyperlink{classSH__ConfirmationState}{SH\_ConfirmationState}(\textcolor{stringliteral}{"Veuillez appuyer sur la touche \(\backslash\)"CONFIRMER\(\backslash\)" pour passer à
       l'étape suivante"}, \textcolor{stringliteral}{"confirm all"});
00032     QFinalState* \textcolor{keyword}{final} = \textcolor{keyword}{new} QFinalState();
00033 
00034 
00035 
00036     connect(nbAdults, &SH\_GenericState::exited, [=]() \{
00037         clientList->\hyperlink{classSH__LoopingInOutStateMachine_a6dbf2fbcc6524bba5a70baadb8d61be4}{setLimit}(\hyperlink{classSH__InOutStateMachine_aa1a3bd3c0ea8a59b9bc916dc718eb9ca}{getContentValue}(\textcolor{stringliteral}{"NBADULTS"}).toInt()-1);
00038     \});
00039 
00040     connect(nbRooms, &SH\_GenericState::exited, [=]() \{
00041         roomsAffectation->\hyperlink{classSH__LoopingInOutStateMachine_a6dbf2fbcc6524bba5a70baadb8d61be4}{setLimit}(\hyperlink{classSH__InOutStateMachine_aa1a3bd3c0ea8a59b9bc916dc718eb9ca}{getContentValue}(\textcolor{stringliteral}{"NBROOMS"}).toInt());
00042     \});
00043 
00044     connect(type, &SH\_GenericState::exited, [=]() \{
00045         billsCreation->\hyperlink{classSH__LoopingInOutStateMachine_a6dbf2fbcc6524bba5a70baadb8d61be4}{setLimit}(\hyperlink{classSH__InOutStateMachine_aa1a3bd3c0ea8a59b9bc916dc718eb9ca}{getContentValue}(\textcolor{stringliteral}{"NBROOMS"}).toInt() * (
      \hyperlink{classSH__InOutStateMachine_aa1a3bd3c0ea8a59b9bc916dc718eb9ca}{getContentValue}(\textcolor{stringliteral}{"BILLINGTYPE\_ID"}).toInt() % 3));
00046     \});
00047 
00048     connect(saveState, &SH\_GenericState::exited, [=]() \{
00049         roomsAffectation->\hyperlink{classSH__LoopingInOutStateMachine_a99686121d80e3de4c64bebb1d5890ac0}{setPersistentContentValue}(
      \hyperlink{classSH__InOutStateMachine_aa1a3bd3c0ea8a59b9bc916dc718eb9ca}{getContentValue}(\textcolor{stringliteral}{"ID"}), \textcolor{stringliteral}{"BILLING\_ID"});
00050         billsCreation->\hyperlink{classSH__LoopingInOutStateMachine_a99686121d80e3de4c64bebb1d5890ac0}{setPersistentContentValue}(
      \hyperlink{classSH__InOutStateMachine_aa1a3bd3c0ea8a59b9bc916dc718eb9ca}{getContentValue}(\textcolor{stringliteral}{"ID"}), \textcolor{stringliteral}{"BILLING\_ID"});
00051     \});
00052 
00053 
00054 
00055 
00056 
00057     \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}* rooms = \textcolor{keyword}{new} 
      \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}(\textcolor{stringliteral}{"Veuillez entrer un numéro de chambre"},\textcolor{stringliteral}{"room
       billing creation"}, \textcolor{stringliteral}{"ROOMS"}, \textcolor{stringliteral}{"NUMBER"});
00058     QFinalState* finalRooms = \textcolor{keyword}{new} QFinalState();
00059     roomsAffectation->addChildrenNextTransition(rooms, finalRooms);
00060     roomsAffectation->\hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{addIOState}(rooms,\textcolor{stringliteral}{"ROOM\_NUMBER"});
00061     roomsAffectation->\hyperlink{classSH__InOutStateMachine_a3de9dedcdfd6efab868484c047638f71}{addState}(finalRooms);
00062     roomsAffectation->setInitialState(rooms);
00063 
00064 
00065 
00066     \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}* supplClient = \textcolor{keyword}{new} 
      \hyperlink{classSH__DatabaseContentQuestionState}{SH\_DatabaseContentQuestionState}(\textcolor{stringliteral}{"Veuillez entrer le nom du client (adulte)
       supplémentaire ou appuyer sur la touche \(\backslash\)"CONFIRMER\(\backslash\)" pour passer à la suite de la facturation"},\textcolor{stringliteral}{"other client
       billing creation"}, \textcolor{stringliteral}{"CLIENTS"}, \textcolor{stringliteral}{"NAME"});
00067     \hyperlink{classSH__ClientCreationStateMachine}{SH\_ClientCreationStateMachine}* supplClientCreation = \textcolor{keyword}{new} 
      \hyperlink{classSH__ClientCreationStateMachine}{SH\_ClientCreationStateMachine}(\textcolor{stringliteral}{"other client creation in billing creation"});
00068     connect(clientList, &\hyperlink{classSH__InOutStateMachine_a7f7d9c9300c1d05bce2c26029f28cc31}{SH\_InOutStateMachine::confirmInput}, [=]() \{
00069         clientList->\hyperlink{classSH__LoopingInOutStateMachine_a73d75e30318da22fec99387e9bf02a9b}{stopLooping}();
00070         supplClient->\hyperlink{classSH__GenericState_ad5e2a1f3dc129336c8f529cf897c2eb0}{next}();
00071     \});
00072     QFinalState* finalClients = \textcolor{keyword}{new} QFinalState();
00073     clientList->addChildrenNextTransition(supplClient, finalClients);
00074     connect(supplClient, &\hyperlink{classSH__QuestionState_a3348a8a683130678ac87a10ba2a25486}{SH\_QuestionState::answerInvalid}, [=]() \{
00075         supplClientCreation->\hyperlink{classSH__InOutStateMachine_a9ab1534306b2bdb62743d4bcefe40c17}{setContentValue}(supplClient->
      \hyperlink{classSH__QuestionState_a29cdea8bc55e39e3ed02d24743c30f8c}{givenAnswer}(), \textcolor{stringliteral}{"NAME"});
00076         supplClient->addTransition(supplClient, SIGNAL(\hyperlink{classSH__GenericStateMachine_af4771d31d87951c997fba1633c2d67f6}{next}()), supplClientCreation);
00077         emit supplClient->\hyperlink{classSH__GenericState_ad5e2a1f3dc129336c8f529cf897c2eb0}{next}();
00078     \});
00079     clientList->addChildrenNextTransition(supplClientCreation, finalClients);
00080     clientList->\hyperlink{classSH__InOutStateMachine_a3de9dedcdfd6efab868484c047638f71}{addState}(finalClients);
00081     clientList->\hyperlink{classSH__InOutStateMachine_a3de9dedcdfd6efab868484c047638f71}{addState}(supplClient);
00082     clientList->setInitialState(supplClient);
00083 
00084 
00085 
00086 
00087     QFinalState* finalBills = \textcolor{keyword}{new} QFinalState();
00088     \hyperlink{classSH__GenericState}{SH\_GenericState}* bills = \textcolor{keyword}{new} \hyperlink{classSH__GenericState}{SH\_GenericState}(\textcolor{stringliteral}{"bill id attribution"});
00089     connect(bills, &SH\_GenericState::entered, [=]() \{
00090         this->\hyperlink{classSH__InOutStateMachine_a9ab1534306b2bdb62743d4bcefe40c17}{setContentValue}(QVariant(billsCreation->\hyperlink{classSH__LoopingInOutStateMachine_afce58401195a4941b1939c46f1caa23b}{current}()), \textcolor{stringliteral}{"BILLINGBILL\_ID"});
00091         \textcolor{keywordtype}{int} billingType = \hyperlink{classSH__InOutStateMachine_aa1a3bd3c0ea8a59b9bc916dc718eb9ca}{getContentValue}(\textcolor{stringliteral}{"BILLINGTYPE\_ID"}).toInt();
00092         \textcolor{keywordtype}{int} billType;
00093         \textcolor{keywordflow}{if}(billingType <= 2) \{
00094             billType = 1+billingType; \textcolor{comment}{//nb facture par chambre}
00095         \} \textcolor{keywordflow}{else} \{
00096             billType = (billsCreation->\hyperlink{classSH__LoopingInOutStateMachine_afce58401195a4941b1939c46f1caa23b}{current}() % (1+(billingType % 3)));
00097         \}
00098 
00099         this->\hyperlink{classSH__InOutStateMachine_a9ab1534306b2bdb62743d4bcefe40c17}{setContentValue}(QVariant(billType), \textcolor{stringliteral}{"BILLTYPE\_ID"});
00100         emit bills->\hyperlink{classSH__GenericState_ad5e2a1f3dc129336c8f529cf897c2eb0}{next}();
00101     \});
00102     billsCreation->addChildrenNextTransition(bills, finalBills);
00103     billsCreation->\hyperlink{classSH__InOutStateMachine_a3de9dedcdfd6efab868484c047638f71}{addState}(finalBills);
00104     billsCreation->\hyperlink{classSH__InOutStateMachine_a3de9dedcdfd6efab868484c047638f71}{addState}(bills);
00105     billsCreation->setInitialState(bills);
00106 
00107 
00108 
00109 
00110     this->addChildrenNextTransition(intro, nbAdults);
00111     this->addChildrenNextTransition(nbAdults, nbChildren);
00112     this->addChildrenNextTransition(nbChildren, arrivingDate);
00113     this->addChildrenNextTransition(arrivingDate, departureDate);
00114     this->addChildrenNextTransition(departureDate, client);
00115     this->addChildrenNextTransition(client, nbRooms);
00116     connect(client, &\hyperlink{classSH__QuestionState_a3348a8a683130678ac87a10ba2a25486}{SH\_QuestionState::answerInvalid}, [=]() \{
00117         clientCreation->\hyperlink{classSH__InOutStateMachine_a9ab1534306b2bdb62743d4bcefe40c17}{setContentValue}(client->\hyperlink{classSH__QuestionState_a29cdea8bc55e39e3ed02d24743c30f8c}{givenAnswer}(),\textcolor{stringliteral}{"NAME"});
00118         client->addTransition(client, SIGNAL(\hyperlink{classSH__GenericStateMachine_af4771d31d87951c997fba1633c2d67f6}{next}()), clientCreation);
00119         emit client->\hyperlink{classSH__GenericState_ad5e2a1f3dc129336c8f529cf897c2eb0}{next}();
00120     \});
00121     this->addChildrenNextTransition(clientCreation, nbRooms);
00122     this->addChildrenNextTransition(nbRooms, type);
00123     this->addChildrenNextTransition(type, \textcolor{keyword}{final});
00124     \textcolor{comment}{//this->addChildrenNextTransition(type, confirmPart1);}
00125     confirmPart1->addTransition(confirmPart1, SIGNAL(\hyperlink{classSH__GenericStateMachine_af4771d31d87951c997fba1633c2d67f6}{next}()), confirmPart1);
00126     connect(confirmPart1, &SH\_GenericState::exited, [=]() \{
00127         connect(saveState, &SH\_GenericState::entered, [=]() \{
00128             \hyperlink{classSH__InOutStateMachine_a9ab1534306b2bdb62743d4bcefe40c17}{setContentValue}(saveState->\hyperlink{classSH__AdaptDatabaseState_a037db544ea05f42d21fcbdda758839fe}{insertUpdate}(
      \hyperlink{classSH__InOutStateMachine_aa009eecc5ab6181358faafb5996b6006}{m\_tableName}, \hyperlink{classSH__InOutStateMachine_a8cfbc27eef057bf37b7711bdfef2077e}{m\_ioContent}), \textcolor{stringliteral}{"ID"});
00129         \});
00130     \});
00131     saveState->addTransition(saveState, SIGNAL(\hyperlink{classSH__GenericStateMachine_af4771d31d87951c997fba1633c2d67f6}{next}()),confirmAll);
00132     \textcolor{comment}{//saveState->addTransition(saveState, SIGNAL(next()),roomsAffectation);}
00133     \textcolor{comment}{//this->addChildrenNextTransition(roomsAffectation, billsCreation);}
00134     \textcolor{comment}{//this->addChildrenNextTransition(billsCreation, clientList);}
00135     \textcolor{comment}{//this->addChildrenNextTransition(clientList, confirmAll);}
00136     this->addChildrenNextTransition(confirmAll, \textcolor{keyword}{final});
00137 
00138     this->\hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{addIOState}(intro,\textcolor{stringliteral}{""});
00139     this->\hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{addIOState}(nbAdults,\textcolor{stringliteral}{"NBADULTS"});
00140     this->\hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{addIOState}(nbChildren,\textcolor{stringliteral}{"NBCHILDREN"});
00141     this->\hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{addIOState}(arrivingDate,\textcolor{stringliteral}{"ARRIVINGDATE"});
00142     this->\hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{addIOState}(departureDate,\textcolor{stringliteral}{"EXPECTEDDEPARTUREDATE"});
00143     this->\hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{addIOState}(client,\textcolor{stringliteral}{"CLIENT\_ID"});
00144     this->\hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{addIOState}(nbRooms,\textcolor{stringliteral}{"NBROOMS"});
00145     this->\hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{addIOState}(type,\textcolor{stringliteral}{"BILLINGTYPE\_ID"});
00146     this->\hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{addIOState}(confirmPart1,\textcolor{stringliteral}{""});
00147     this->\hyperlink{classSH__InOutStateMachine_ab6e90f9e187ab70d51ed4e3e1f69f912}{addIOState}(confirmAll,\textcolor{stringliteral}{""});
00148     \textcolor{comment}{//this->addIOStateMachine(billsCreation);}
00149     \textcolor{comment}{//this->addIOStateMachine(roomsAffectation);}
00150     \textcolor{comment}{//this->addIOStateMachine(clientList);}
00151     this->\hyperlink{classSH__InOutStateMachine_a3de9dedcdfd6efab868484c047638f71}{addState}(\textcolor{keyword}{final});
00152 
00153     this->setInitialState(intro);
00154 \}
\end{DoxyCode}
