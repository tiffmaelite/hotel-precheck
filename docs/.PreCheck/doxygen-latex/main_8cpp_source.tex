\hypertarget{main_8cpp_source}{\section{main.\-cpp}
}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include <QtWidgets/QApplication>}
00002 \textcolor{preprocessor}{#include <QtQml>}
00003 \textcolor{preprocessor}{#include <QtQuick>}
00004 \textcolor{preprocessor}{#include <QProgressDialog>}
00005 \textcolor{preprocessor}{#include "\hyperlink{SH__MessageManager_8h}{SH\_MessageManager.h}"}
00006 \textcolor{preprocessor}{#include "\hyperlink{SH__ApplicationCore_8h}{SH\_ApplicationCore.h}"}
00007 \textcolor{preprocessor}{#include "\hyperlink{SH__ExtendedSqlProxyModel_8h}{models/SH\_ExtendedSqlProxyModel.h}"}
00008 \textcolor{preprocessor}{#include "\hyperlink{SH__RoomsTableModel_8h}{models/SH\_RoomsTableModel.h}"}
00009 \textcolor{preprocessor}{#include "\hyperlink{SH__SqlDataField_8h}{models/SH\_SqlDataField.h}"}
00010 \textcolor{preprocessor}{#include "\hyperlink{SH__BillingsTableModel_8h}{models/SH\_BillingsTableModel.h}"}
00011 \textcolor{preprocessor}{#include "\hyperlink{SH__BillsTableModel_8h}{models/SH\_BillsTableModel.h}"}
00012 \textcolor{preprocessor}{#include "\hyperlink{SH__BookingsTableModel_8h}{models/SH\_BookingsTableModel.h}"}
00013 \textcolor{preprocessor}{#include "\hyperlink{SH__RoomsTableModel_8h}{models/SH\_RoomsTableModel.h}"}
00014 \textcolor{preprocessor}{#include "\hyperlink{SH__ClientsTableModel_8h}{models/SH\_ClientsTableModel.h}"}
00015 \textcolor{preprocessor}{#include "\hyperlink{SH__ServicesTableModel_8h}{models/SH\_ServicesTableModel.h}"}
00016 \textcolor{preprocessor}{#include "\hyperlink{SH__GroupsTableModel_8h}{models/SH\_GroupsTableModel.h}"}
00017 \textcolor{preprocessor}{#include "\hyperlink{SH__User_8h}{models/SH\_User.h}"}
00018 \textcolor{preprocessor}{#include "\hyperlink{SH__ExtendedQQmlAction_8h}{views/SH\_ExtendedQQmlAction.h}"}
00019 \textcolor{preprocessor}{#include "\hyperlink{QsLog_8h}{logging/QsLog.h}"}
00020 \textcolor{preprocessor}{#include "\hyperlink{QsLogDest_8h}{logging/QsLogDest.h}"}
00021 
00022 
\hypertarget{main_8cpp_source_l00023}{}\hyperlink{main_8cpp_aab83ac6564fd72e82c62b21733ca0e1b}{00023} \textcolor{keyword}{const} \textcolor{keywordtype}{int} \hyperlink{main_8cpp_aab83ac6564fd72e82c62b21733ca0e1b}{iterations} = 20;
00024 
00025 
\hypertarget{main_8cpp_source_l00031}{}\hyperlink{main_8cpp_aaf7c4666a49fc2890c12b6ae393b8deb}{00031} \textcolor{keywordtype}{void} \hyperlink{main_8cpp_aaf7c4666a49fc2890c12b6ae393b8deb}{statusChanged}(QQmlComponent* component, QQmlComponent::Status status) \{
00032     \textcolor{keywordflow}{if} (status == QQmlComponent::Error) \{
00033         \textcolor{keywordflow}{foreach} (\textcolor{keyword}{const} QQmlError &error, component->errors()) \{
00034             \textcolor{keyword}{const} QByteArray file = error.url().toEncoded();
00035             QMessageLogger(file.constData(), error.line(), 0).debug() << error.description();
00036         \}
00037     \}
00038 \}
00039 
\hypertarget{main_8cpp_source_l00046}{}\hyperlink{main_8cpp_a5e94203dceafb66df570cbbc79cb52bc}{00046} \textcolor{keywordtype}{void} \hyperlink{main_8cpp_a5e94203dceafb66df570cbbc79cb52bc}{exportlog}(QtMsgType type, \textcolor{keyword}{const} QMessageLogContext &context, \textcolor{keyword}{const} QString &msg) \{
00047     QFile file(QApplication::applicationDirPath()+\textcolor{stringliteral}{"/"}+qAppName()+\textcolor{stringliteral}{".log"});
00048     file.open(QIODevice::WriteOnly | QIODevice::Append);
00049     file.write(QString(\textcolor{stringliteral}{"["}).toUtf8()+QDateTime::currentDateTime().toString().toUtf8()+QString(\textcolor{stringliteral}{"] "}).toUtf8(
      ));
00050     QString typeName;
00051     \textcolor{keywordflow}{switch} (type) \{
00052     \textcolor{keywordflow}{case} QtDebugMsg:
00053         typeName = QObject::tr(\textcolor{stringliteral}{"Debug"});
00054         \textcolor{keywordflow}{break};
00055     \textcolor{keywordflow}{case} QtWarningMsg:
00056         typeName = QObject::tr(\textcolor{stringliteral}{"Warning"});
00057         \textcolor{keywordflow}{break};
00058     \}
00059     file.write(QObject::tr(\textcolor{stringliteral}{"%1: %2\(\backslash\)r\(\backslash\)n"}).arg(typeName).arg(msg).toUtf8());
00060 \}
00061 
00062 
\hypertarget{main_8cpp_source_l00071}{}\hyperlink{main_8cpp_ac3c79e35c4fc5c50939ae90485e1483f}{00071} \textcolor{keywordtype}{void} \hyperlink{main_8cpp_ac3c79e35c4fc5c50939ae90485e1483f}{enableLogging}(\textcolor{keyword}{const} QString sLogPath)
00072 \{
00073     \textcolor{comment}{/* init the logging mechanism*/}
00074     \hyperlink{classQsLogging_1_1Logger}{QsLogging::Logger}& logger = \hyperlink{classQsLogging_1_1Logger_a26fd3242d362eeeb3b38940a714ea6fa}{QsLogging::Logger::instance}();
00075     logger.\hyperlink{classQsLogging_1_1Logger_aa34d1a0d83e180f15e23a03f9de872c6}{setLoggingLevel}(\hyperlink{namespaceQsLogging_a38c7dd87e4de6f8eb460763ad0baa033a187ba10e2b3b400c6ee33afe6fc10915}{QsLogging::TraceLevel});
00076 
00077     \hyperlink{namespaceQsLogging_a8fe41cf859d617f1c23515f804d1e8ec}{QsLogging::DestinationPtr} fileDestination(
00078                 \hyperlink{classQsLogging_1_1DestinationFactory_abc128b6640d5716b91c681df960b878c}{QsLogging::DestinationFactory::MakeFileDestination}
      (sLogPath, \textcolor{keyword}{true}, 512, 2) );
00079     \hyperlink{namespaceQsLogging_a8fe41cf859d617f1c23515f804d1e8ec}{QsLogging::DestinationPtr} debugDestination(
00080                 \hyperlink{classQsLogging_1_1DestinationFactory_a69eecb9933440870bb809c4e32ac1987}{QsLogging::DestinationFactory::MakeDebugOutputDestination}
      () );
00081     logger.\hyperlink{classQsLogging_1_1Logger_a76a32c839e837547b14bc5e523b4aa45}{addDestination}(debugDestination);
00082     logger.\hyperlink{classQsLogging_1_1Logger_a76a32c839e837547b14bc5e523b4aa45}{addDestination}(fileDestination);
00083 
00084     logger.\hyperlink{classQsLogging_1_1Logger_aa34d1a0d83e180f15e23a03f9de872c6}{setLoggingLevel}(\hyperlink{namespaceQsLogging_a38c7dd87e4de6f8eb460763ad0baa033a64b8289ed8a99f811404140cbcb2549c}{QsLogging::OffLevel}); \textcolor{comment}{/*truning logging off*/}
00085 
00086 
00087     \textcolor{comment}{/*qInstallMessageHandler(exportlog);*/}
00088 
00089     \textcolor{comment}{/* QLOG\_INFO() << "Here is some information";}
00090 \textcolor{comment}{}
00091 \textcolor{comment}{        QLOG\_TRACE() << "Here's a" << QString::fromUtf8("trace") << "message";}
00092 \textcolor{comment}{        QLOG\_DEBUG() << "Here's a" << static\_cast<int>(QsLogging::DebugLevel) << "message";}
00093 \textcolor{comment}{        QLOG\_WARN()  << "Uh-oh!";}
00094 \textcolor{comment}{        qDebug() << "This message won't be picked up by the logger";}
00095 \textcolor{comment}{        QLOG\_ERROR() << "An example error has occurred";}
00096 \textcolor{comment}{        qWarning() << "Neither will this one";}
00097 \textcolor{comment}{        QLOG\_FATAL() << "Fatal error example!";*/}
00098 \}
00099 
00100 
00101 
00102 
\hypertarget{main_8cpp_source_l00108}{}\hyperlink{main_8cpp_ae410a0b90b40ede93034f3ec13d27b8e}{00108} \textcolor{keywordtype}{void} \hyperlink{main_8cpp_ae410a0b90b40ede93034f3ec13d27b8e}{spin}(\textcolor{keywordtype}{int} &iteration)
00109 \{
00110     \textcolor{keyword}{const} \textcolor{keywordtype}{int} work = 1000 * 1000 * 40;
00111     \textcolor{keyword}{volatile} \textcolor{keywordtype}{int} v = 0;
00112     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < work; ++j)
00113         ++v;
00114 
00115     qDebug() << \textcolor{stringliteral}{"iteration"} << iteration << \textcolor{stringliteral}{"in thread"} << QThread::currentThreadId();
00116 \}
00117 
\hypertarget{main_8cpp_source_l00125}{}\hyperlink{main_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{00125} \textcolor{keywordtype}{int} \hyperlink{main_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{main}(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv)
00126 \{
00127     \textcolor{keywordflow}{try}
00128     \{
00129         qDebug();  \textcolor{comment}{/* Un simple retour Ã  la ligne pour un affichage propre dans la console*/}
00130 
00131         QApplication app(argc, argv);
00132 
00133         \textcolor{keyword}{const} QString sLogPath(QDir::cleanPath(app.applicationDirPath()+\textcolor{stringliteral}{"
      /../../../src/PreCheck/debugLog.txt"}));
00134         qDebug() << app.applicationDirPath();
00135         qDebug() << QDir::cleanPath(app.applicationDirPath()+\textcolor{stringliteral}{"/../../../src/PreCheck/debugLog.txt"});
00136         \hyperlink{main_8cpp_ac3c79e35c4fc5c50939ae90485e1483f}{enableLogging}(sLogPath);
00137 
00138         QString appName = QString(QObject::tr(\textcolor{stringliteral}{"precheck"}));
00139         QString locale = QLocale::system().name();
00140         QTranslator translator;
00141         \textcolor{keywordflow}{if} (!QFile::exists(appName + \textcolor{stringliteral}{"\_"} + locale + \textcolor{stringliteral}{".qm"}))
00142         \{
00143             locale = locale.section(\textcolor{charliteral}{'\_'}, 0, 0);
00144         \}
00145         \textcolor{keywordflow}{if} (QFile::exists(appName + \textcolor{stringliteral}{"\_"} + locale + \textcolor{stringliteral}{".qm"}))
00146         \{
00147             translator.load(appName + \textcolor{stringliteral}{"\_"} + locale);
00148             app.installTranslator(&translator);
00149         \}
00150 
00151         QQmlEngine engine;
00152 
00153         qmlRegisterUncreatableType<SH\_ApplicationCore>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"AppMode"},\textcolor{stringliteral}{"pour enum AppMode"});
00154         qmlRegisterType<SH\_User>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"User"});
00155         \hyperlink{classSH__ApplicationCore}{SH\_ApplicationCore}* appManager = \textcolor{keyword}{new} 
      \hyperlink{classSH__ApplicationCore}{SH\_ApplicationCore}();
00156         engine.rootContext()->setContextProperty(\textcolor{stringliteral}{"SH\_App"}, appManager);
00157 
00158         qmlRegisterType<SH\_RoomsTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_RoomsModel"});
00159         qmlRegisterType<SH\_BillingsTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_BillingsModel"});
00160         qmlRegisterType<SH\_BillsTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_BillsModel"});
00161         qmlRegisterType<SH\_BookingsTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_BookingsModel"});
00162         qmlRegisterType<SH\_ServicesTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_ServicesModel"});
00163         qmlRegisterType<SH\_ClientsTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_ClientsModel"});
00164         qmlRegisterType<SH\_GroupsTableModel>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_GroupsModel"});
00165         qmlRegisterType<SH\_SqlDataFields>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_SqlDataField"});
00166         qmlRegisterType<SH\_ExtendedQQmlAction>(\textcolor{stringliteral}{"PreCheck"}, 1, 0, \textcolor{stringliteral}{"SH\_ComplexAction"});
00167 
00168         QQmlComponent component(&engine);
00169         component.loadUrl(QUrl(\textcolor{stringliteral}{"qrc:/qml/SH\_app.qml"}));
00170         \textcolor{keywordflow}{if} (!component.isReady())
00171         \{
00172             qWarning(\textcolor{stringliteral}{"%s"}, qPrintable(component.errorString()));
00173             \textcolor{keywordflow}{return} -1;
00174         \}
00175         \hyperlink{classQObject}{QObject} *topLevel = component.create();
00176         QQuickWindow *window = qobject\_cast<QQuickWindow *>(topLevel);
00177         \textcolor{keywordflow}{if} (!window)
00178         \{
00179             qWarning(\textcolor{stringliteral}{"Error: Your root item has to be a Window."});
00180             \textcolor{keywordflow}{return} -1;
00181         \}
00182         QObject::connect(&engine, SIGNAL(quit()), &app, SLOT(quit()));
00183 
00184 
00185         \hyperlink{classQObject}{QObject} * commonPage = window->findChild<\hyperlink{classQObject}{QObject} *>(\textcolor{stringliteral}{"Common"});
00186         \hyperlink{classQObject}{QObject} * tabsZone = commonPage->findChild<\hyperlink{classQObject}{QObject} *>(\textcolor{stringliteral}{"TabView"});
00187         \hyperlink{classQObject}{QObject} * displayZone = commonPage->findChild<\hyperlink{classQObject}{QObject} *>(\textcolor{stringliteral}{"RightOutput"});
00188 
00189         QObject::connect(appManager, SIGNAL(openTab(QVariant)), tabsZone, SLOT(openTab(QVariant)), 
      Qt::DirectConnection);
00190         QObject::connect(appManager, SIGNAL(sendText(QString)), displayZone, SIGNAL(displayNewFixed(QString
      )), Qt::DirectConnection);
00191         QObject::connect(appManager, SIGNAL(sendText(QString)), displayZone, SIGNAL(replace(QString)), 
      Qt::DirectConnection);
00192         QObject::connect(appManager, SIGNAL(clearAll()), displayZone, SLOT(clearAll()), 
      Qt::QueuedConnection);
00193         \textcolor{comment}{/*QObject::connect(appManager, SIGNAL(displayCalendar()), displayZone, SLOT(displayCalendar()),
       Qt::DirectConnection);*/}
00194 
00195         window->show();
00196         \hyperlink{QsLog_8h_ad8aec737ba0e3607fb5be7590c6ab0ff}{QLOG\_INFO}() << \textcolor{stringliteral}{"Program built with Qt"} << QT\_VERSION\_STR << \textcolor{stringliteral}{"running on"} << qVersion();
00197         \textcolor{keywordflow}{return} app.exec();
00198 
00199     \}
00200     \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} std::exception &e)
00201     \{
00202         \hyperlink{classSH__MessageManager_acb5615cc90f198f4768da800a5d32362}{SH\_MessageManager::errorMessage}(e.what());
00203     \}
00204 \}
\end{DoxyCode}
