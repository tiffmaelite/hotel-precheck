SELECT genall_upsertID();

SELECT gen_upsert('BILLINGSTYPES', 'NBBILLS=CAST(NEW.NBBILLS AS SMALLINT)', 'LABEL=NEW.LABEL', 'ID');

SELECT gen_upsert('BILLS', 'BILLTYPE_ID=CAST(NEW.BILLTYPE_ID AS INTEGER), NOTE=NEW.NOTE', 'BILLING_ID=CAST(NEW.BILLING_ID AS INTEGER) AND BILLINGBILLID=CAST(NEW.BILLINGBILLID AS INTEGER)', 'ID');

SELECT gen_upsert('TRAINING_BILLS', 'BILLTYPE_ID=CAST(NEW.BILLTYPE_ID AS INTEGER), NOTE=NEW.NOTE', 'BILLING_ID=CAST(NEW.BILLING_ID AS INTEGER) AND BILLINGBILLID=CAST(NEW.BILLINGBILLID AS INTEGER)', 'ID');

SELECT gen_upsert('CHARGEDSERVICES', 'INVOICINGDATE=CAST(NEW.INVOICINGDATE AS DATE),QUANTITY=CAST(NEW.QUANTITY AS SMALLINTEGER), CHARGEDUNITPRICE=CAST(NEW.CHARGEDUNITPRICE AS DECIMAL), VAT_PERCENTAGE=CAST(NEW.VAT_PERCENTAGE AS DECIMAL), ISPRINTED=CAST(NEW.ISPRINTED AS BOOLEAN), ISPAYED=CAST(NEW.ISPAYED AS BOOLEAN), PAIEMENTDATE=CAST(NEW.PAIEMENTDATE AS DATE)', 'SERVICE_ID=CAST(NEW.SERVICE_ID AS INTEGER) AND BILL_ID=CAST(NEW.BILL_ID AS INTEGER)', 'BILL_ID');

SELECT gen_upsert('TRAINING_CHARGEDSERVICES', 'INVOICINGDATE=CAST(NEW.INVOICINGDATE AS DATE),QUANTITY=CAST(NEW.QUANTITY AS SMALLINTEGER), CHARGEDUNITPRICE=CAST(NEW.CHARGEDUNITPRICE AS DECIMAL), VAT_PERCENTAGE=CAST(NEW.VAT_PERCENTAGE AS DECIMAL), ISPRINTED=CAST(NEW.ISPRINTED AS BOOLEAN), ISPAYED=CAST(NEW.ISPAYED AS BOOLEAN), PAIEMENTDATE=CAST(NEW.PAIEMENTDATE AS DATE)', 'SERVICE_ID=CAST(NEW.SERVICE_ID AS INTEGER) AND BILL_ID=CAST(NEW.BILL_ID AS INTEGER)', 'BILL_ID');

SELECT gen_upsertmult('REPORTSTYPES', array['GENERATIONQUERY=NEW.GENERATIONQUERY','LABEL=NEW.LABEL'], array['LABEL=NEW.LABEL','GENERATIONQUERY=NEW.GENERATIONQUERY'], 'LABEL');

SELECT gen_upsert('ROOMS', 'ROOMTYPE_ID=CAST(NEW.ROOMTYPE_ID AS INTEGER), FLOOR=CAST(NEW.FLOOR AS SMALLINTEGER), ISCLEANED=CAST(NEW.ISCLEANED AS BOOLEAN)', 'NUMBER=CAST(NEW.NUMBER AS SMALLINTEGER)', 'ID');

SELECT gen_upsertmult('ROOMSOCCUPATIONS', array['ARRIVINGDATE=CAST(NEW.ARRIVINGDATE AS DATE), DEPARTUREDATE=CAST(NEW.DEPARTUREDATE AS DATE)','BILLING_ID=CAST(NEW.BILLING_ID AS INTEGER), DEPARTUREDATE=CAST(NEW.DEPARTUREDATE AS DATE)','ARRIVINGDATE=CAST(NEW.ARRIVINGDATE AS DATE), BILLING_ID=CAST(NEW.BILLING_ID AS INTEGER)'], array['ROOM_ID=CAST(NEW.ROOM_ID AS INTEGER) AND BILLING_ID=CAST(NEW.BILLING_ID AS INTEGER)','ROOM_ID=CAST(NEW.ROOM_ID AS INTEGER) AND ARRIVINGDATE=CAST(NEW.ARRIVINGDATE AS DATE)','ROOM_ID=CAST(NEW.ROOM_ID AS INTEGER) AND DEPARTUREDATE=CAST(NEW.DEPARTUREDATE AS DATE)'], 'ROOM_ID');

SELECT gen_upsert('ROOMSTYPES', 'DESCRIPTION=NEW.DESCRIPTION, PRICEMIN=CAST(NEW.PRICEMIN AS DECIMAL), PRICEMAX=CAST(NEW.PRICEMAX AS DECIMAL)', 'LABEL=NEW.LABEL', 'ID');

SELECT gen_upsert('SERVICESDETAILS', 'FIELDVALUE=NEW.FIELDVALUE', 'SERVICEFIELD_ID=CAST(NEW.SERVICEFIELD_ID AS INTEGER) AND SERVICE_ID=CAST(NEW.SERVICE_ID AS INTEGER)', 'ID');

SELECT gen_upsert('SERVICESFIELDS', 'SQLTYPE=NEW.SQLTYPE', 'LABEL=NEW.LABEL', 'ID');

SELECT gen_upsert('SERVICES', 'SERVICETYPE_ID=CAST(NEW.SERVICETYPE_ID AS INTEGER), ISAVAILABLE=CAST(NEW.ISAVAILABLE AS BOOLEAN)', 'NAME=NEW.NAME', 'ID');

SELECT gen_upsert('SERVICESTYPES', 'SERVICEFAMILY_ID=CAST(NEW.SERVICEFAMILY_ID AS INTEGER), VAT_ID=CAST(NEW.VAT_ID AS INTEGER), ROOMNEEDED=CAST(NEW.ROOMNEEDED AS BOOLEAN)', 'LABEL=NEW.LABEL', 'ID');

SELECT gen_upsert('USERS', 'ENCRYPTEDPASS=NEW.ENCRYPTEDPASS, ISRECEPTIONIST=CAST(NEW.ISRECEPTIONIST AS BOOLEAN), ISMANAGERX=CAST(NEW.ISMANAGERX AS BOOLEAN), ISMANAGERZ=CAST(NEW.ISMANAGERZ AS BOOLEAN), ISADMINISTRATOR=CAST(NEW.ISADMINISTRATOR AS BOOLEAN)', 'LOGIN=NEW.LOGIN', 'ID');

SELECT gen_upsert('TRAINEES', 'ENCRYPTEDPASS=NEW.ENCRYPTEDPASS, ISACTIVATED=CAST(NEW.ISACTIVATED AS BOOLEAN)', 'LOGIN=NEW.LOGIN', 'ID');




SELECT gen_upsert('ADDRESSES_ARCHIVE', 'client_id=CAST(NEW.client_ID AS INTEGER), zipcode=NEW.zipcode, phone=NEW.phone,complementaryline=NEW.complementaryline', 'contact=NEW.contact AND street=NEW.street AND number=NEW.number AND city=NEW.city AND country=NEW.country', 'ID');

SELECT gen_upsert('GROUPS_ARCHIVE', 'CONTACT_ID=CAST(NEW.CONTACT_ID AS INTEGER)', 'NAME=NEW.NAME', 'ID');

SELECT gen_upsert('BALANCELOG_ARCHIVE', 'balance=CAST(NEW.balance AS DECIMAL)', 'yearlog=CAST(NEW.yearlog AS SMALLINTEGER) AND monthlog=CAST(NEW.monthlog AS SMALLINTEGER) AND daylog=CAST(NEW.daylog AS SMALLINTEGER) AND hourlog=CAST(NEW.hourlog AS SMALLINTEGER)', 'BALANCE');

SELECT gen_upsert('NATIONALITIES_ARCHIVE', 'COUNTRY=NEW.COUNTRY, LONGISOCODE=NEW.LONGISOCODE, ISOCODE=NEW.ISOCODE', 'CODE=CAST(NEW.CODE AS SMALLINTEGER)', 'ID');

SELECT gen_upsertmult('CLIENTS_ARCHIVE', array['NAME=NEW.NAME, PHONE=NEW.PHONE, IDCARDSCAN=NEW.IDCARDSCAN, NATIONALITY_ID=CAST(NEW.NATIONALITY_ID AS INTEGER), HOMEADDRESS_ID=CAST(NEW.HOMEADDRESS_ID AS INTEGER), ISCURRENT=CAST(NEW.ISCURRENT AS BOOLEAN)','EMAIL=NEW.EMAIL, PHONE=NEW.PHONE, NATIONALITY_ID=CAST(NEW.NATIONALITY_ID AS INTEGER), HOMEADDRESS_ID=CAST(NEW.HOMEADDRESS_ID AS INTEGER),ISCURRENT=CAST(NEW.ISCURRENT AS BOOLEAN)', 'EMAIL=NEW.EMAIL, PHONE=NEW.PHONE, IDCARDSCAN=NEW.IDCARDSCAN, NATIONALITY_ID=CAST(NEW.NATIONALITY_ID AS INTEGER), ISCURRENT=CAST(NEW.ISCURRENT AS BOOLEAN)'], array['EMAIL=NEW.EMAIL','NAME=NEW.NAME AND IDCARDSCAN=NEW.IDCARDSCAN AND IDCARDSCAN IS NOT NULL','NAME=NEW.NAME AND HOMEADDRESS_ID=CAST(NEW.HOMEADDRESS_ID AS INTEGER) AND HOMEADDRESS_ID IS NOT NULL'], 'ID');



INSERT INTO ROOMSTYPES
  (LABEL, DESCRIPTION, PRICEMIN, PRICEMAX)
VALUES
  ('1L+D', '1 lit en 80x200 + 1 douche', 100, 120),
  ('1GL+D', '1 lit en 160x200 + 1 douche', 120, 150),
  ('1pGL+D', '1 lit en 140x190 ou en 140x200 + 1 douche', 135, 145),
  ('2L+D', '2 lits en 80x200 + 1 douche', 150, 165),
  ('2L+B', '2 lits en 80x200 + 1 baignoire', 150, 165),
  ('2Lc+D', '2 lits en 90x200 + 1 douche', 160, 180),
  ('2Lc+B', '2 lits en 90x200 + 1 baignoire', 160, 180),
  ('Junior Suite', '2 lits en 90x200 ou 1 lit 140x200 + 1 baignoire', 170, 195),
  ('3L+B', '3 lits en 80x200 + 1 baignoire', 175, 200),
  ('2L+1pGL+B', '2 lits en 80x200 + 1 lit 140x200 + 1 baignoire', 185, 215),
  ('3L+1pGL+B', '3 lits en 80x200 + 1 lit 140x200 + 1 baignoire', 195, 255),
  ('appartement', '', 300, 300),
  ('studio', '', 350, 350);



INSERT INTO ROOMS
  (ROOMTYPE_ID, NUMBER, FLOOR)
VALUES
  (1, 309, 3),
  (1, 509, 5),
  (1, 710, 7),
  (1, 711, 7),
  (1, 712, 7),
  (3, 308, 3),
  (3, 307, 3),
  (3, 407, 4),
  (3, 507, 5),
  (3, 607, 6),
  (2, 707, 7),
  (2, 605, 6),
  (2, 207, 2),
  (4, 201, 2),
  (4, 202, 2),
  (4, 203, 2),
  (4, 205, 2),
  (4, 206, 2),
  (4, 301, 3),
  (4, 302, 3),
  (4, 303, 3),
  (4, 305, 3),
  (4, 306, 3),
  (8, 310, 3),
  (7, 311, 3),
  (4, 401, 4),
  (4, 402, 4),
  (4, 403, 4),
  (4, 405, 4),
  (4, 406, 4),
  (5, 408, 4),
  (5, 411, 4),
  (4, 501, 5),
  (4, 502, 5),
  (4, 503, 5),
  (4, 505, 5),
  (4, 506, 5),
  (5, 508, 5),
  (4, 601, 6),
  (4, 602, 6),
  (4, 603, 6),
  (4, 606, 6),
  (4, 701, 7),
  (4, 705, 7),
  (4, 706, 7),
  (4, 708, 7),
  (8, 510, 5),
  (7, 511, 5),
  (7, 704, 7),
  (9, 304, 3),
  (9, 504, 5),
  (9, 604, 6),
  (10, 204, 2),
  (10, 404, 4),
  (12, 410, 4),
  (12, 702, 7),
  (13, 132, 7);


INSERT INTO TAXES
  (LABEL, PERCENTAGE, STARTDATE, ENDDATE)
VALUES
  ('0%',0.0,null,null),
  ('2,5%',2.5,null,null),
  ('3,8%',3.8,'1996-01-01','2017-01-01'),
  ('8%',8.0,null,null);

INSERT INTO SERVICESFAMILIES
  (LABEL)
VALUES
  ('Arrangement'),
  ('Repas'),
  ('Prestations');

INSERT INTO SERVICESTYPES
  (LABEL, SERVICEFAMILY_ID, VAT_ID, ROOMNEEDED, CODE)
VALUES
  ('Autre',3,1, '1', 1),
  ('Taxe de séjour',1,1, '1', 1),
  ('Accomodation',1,1, '1', 2),
  ('Repas',2,1, '1', 1),
  ('Prestation extra',3,1, '1', 2),
  ('Vente au comptant',3,1, '0', 3);



INSERT INTO SERVICESFIELDS
  (LABEL, SQLTYPE)
VALUES
  ('DISPLAYEDNAME','VARCHAR(100)'),
  ('PRINTEDNAME','VARCHAR(100)'),
  ('PRICEMIN','DECIMAL'),
  ('PRICEMAX','DECIMAL');


INSERT INTO SERVICES
  (ID, SERVICETYPE_ID, NAME, ISAVAILABLE, CODE)
VALUES
  (-1, 1, 'Autre...', '1', 1),
  (0, 1, 'Autre', '1', 2);

INSERT INTO SERVICES
  (SERVICETYPE_ID, NAME, ISAVAILABLE, CODE)
VALUES
  (2, 'Taxe de séjour adulte', '1', 1),
  (2, 'Taxe de séjour enfant', '1', 2),
  (3, 'Logement', '1', 1),
  (3, 'Logement et petit-déjeuner','1', 2),
  (3, 'Arrangement demi-pension', '1', 3),
  (3, 'Arrangement pension complète','1', 4),
  (4, 'Demi-pension', '1', 1),
  (4, 'Pension complète','1', 2),
  (4, 'Restaurant','1',3),
  (4, 'Bistro','1', 4),
  (5, 'Petit-déjeuner','1', 1),
  (5, 'Extras petit-déjeuner','1',2),
  (5, 'Fax','1', 3),
  (5, 'Garage', '1', 4),
  (5, 'Téléphone','1', 5),
  (5, 'Wifi chambre','0', 6),
  (5, 'Lingerie','1', 7),
  (5, 'Service en chambre','1', 8),
  (6, 'Timbre', '1', 1),
  (6, 'Location salle','1', 2),
  (6, 'Débours', '1', 3),
  (6, 'Rabais', '1', 4);


INSERT INTO SERVICESDETAILS
  (SERVICE_ID,SERVICEFIELD_ID, FIELDVALUE)
VALUES
  (-1,1,'Autre...'),
  (-1,2,'Autre...'),
  (-1,3,'0'),
  (-1,4,'0'),
  (0, 1,'Autre'),
  (0, 2,'Autre'),
  (0, 3,'0'),
  (0, 4,'0'),
  (1,1,'Taxe de séjour adulte'),
  (1,2,'Taxe de séjour adulte'),
  (1,3,'2'),
  (1,4,'2'),
  (2,1,'Taxe de séjour enfant'),
  (2,2,'Taxe de séjour enfant'),
  (2,3,'1'),
  (2,4,'1'),
  (3,1,'Logement'),
  (3,2,'Logement'),
  (3,3,'-1'),
  (3,4,'-1'),
  (4,1,'Logement et petit-déjeuner'),
  (4,2,'Logement+p.dej'),
  (4,3,'-1'),
  (4,4,'-1'),
  (5,1,'Arrangement demi-pension'),
  (5,2,'Arrangement 1/2 pension'),
  (5,3,'-1'),
  (5,4,'-1'),
  (6,1,'Arrangement pension complète'),
  (6,2,'Arrangement pension comp.'),
  (6,3,'-1'),
  (6,4,'-1'),
  (7,1,'Demi-pension'),
  (7,2,'1/2 pension'),
  (7,3,'25'),
  (7,4,'25'),
  (8,1,'Pension complète'),
  (8,2,'Pension complète'),
  (8,3,'50'),
  (8,4,'50'),
  (9,1,'Petit-déjeuner'),
  (9,2,'Petit-déjeuner'),
  (9,3,'0'),
  (9,4,'0'),
  (10,1,'Extras petit-déjeuner'),
  (10,2,'Extras p.dej'),
  (10,3,'0'),
  (10,4,'0'),
  (11,1,'Restaurant'),
  (11,2,'Restaurant'),
  (11,3,'0'),
  (11,4,'0'),
  (12,1,'Bistro'),
  (12,2,'Bistro'),
  (12,3,'0'),
  (12,4,'0'),
  (13,1,'Fax'),
  (13,2,'Fax'),
  (13,3,'0'),
  (13,4,'0'),
  (14,1,'Garage'),
  (14,2,'Garage'),
  (14,3,'0'),
  (14,4,'0'),
  (15,1,'Téléphone'),
  (15,2,'Téléphone'),
  (15,3,'0'),
  (15,4,'0'),
  (16,1,'Wifi chambre'),
  (16,2,'Wifi chambre'),
  (16,3,'5'),
  (16,4,'5'),
  (17,1,'Timbre'),
  (17,2,'Timbre'),
  (17,3,'0'),
  (17,4,'0'),
  (18,1,'Lingerie'),
  (18,2,'Lingerie'),
  (18,3,'0'),
  (18,4,'0'),
  (19,1,'Location salle'),
  (19,2,'Location salle'),
  (19,3,'0'),
  (19,4,'0'),
  (20,1,'Débours'),
  (20,2,'Débours'),
  (20,3,'0'),
  (20,4,'0'),
  (21,1,'Rabais'),
  (21,2,'Rabais'),
  (21,3,'0'),
  (21,4,'0'),
  (22,1,'Service en chambre'),
  (22,2,'Service en chambre'),
  (22,3,'0'),
  (22,4,'0');



INSERT INTO USERS
  (LOGIN, ENCRYPTEDPASS, ISRECEPTIONIST, ISMANAGERX, ISMANAGERZ, ISADMINISTRATOR)
VALUES
  ('hotel','EE26B0DD4AF7E749AA1A8EE3C10AE9923F618980772E473F8819A5D4940E0DB27AC185F8A0E1D5F84F88BC887FD67B143732C304CC5FA9AD8E6F57F50028A8FF','1','0','0','0'),
 ('manX','EE26B0DD4AF7E749AA1A8EE3C10AE9923F618980772E473F8819A5D4940E0DB27AC185F8A0E1D5F84F88BC887FD67B143732C304CC5FA9AD8E6F57F50028A8FF','1','1','0','0'),
 ('manZ','EE26B0DD4AF7E749AA1A8EE3C10AE9923F618980772E473F8819A5D4940E0DB27AC185F8A0E1D5F84F88BC887FD67B143732C304CC5FA9AD8E6F57F50028A8FF','1','1','1','0'),
 ('admin','EE26B0DD4AF7E749AA1A8EE3C10AE9923F618980772E473F8819A5D4940E0DB27AC185F8A0E1D5F84F88BC887FD67B143732C304CC5FA9AD8E6F57F50028A8FF','0','0','1','1');



INSERT INTO TRAINEES
  (LOGIN, ENCRYPTEDPASS, ISACTIVATED)
VALUES
  ('formation','EE26B0DD4AF7E749AA1A8EE3C10AE9923F618980772E473F8819A5D4940E0DB27AC185F8A0E1D5F84F88BC887FD67B143732C304CC5FA9AD8E6F57F50028A8FF', '1');


INSERT INTO REPORTSTYPES
  (LABEL, DESCRIPTION, GENERATIONQUERY)
VALUES
  ('today balance','Comptabilisateurs journaliers', 'SELECT dbalance, ddaylog, dmonthlog, dyearlog FROM dailybalcount GROUP BY dyearlog, dmonthlog, ddaylog HAVING dcreationtime = (SELECT MAX(dcreationtime) FROM dailybalcount);'),
  ('total balance','Journal des comptabilisateurs', 'SELECT balance, hourlog, daylog, monthlog, yearlog FROM balance_archiveORDER BY yearlog, monthlog, daylog, hourlog;');

